!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){function escapeHtmlChar(chr){return htmlEscapes[chr]}function escape(string){return string=baseToString(string),string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}var baseToString=require("lodash._basetostring"),reUnescapedHtml=/[&<>"'`]/g,reHasUnescapedHtml=RegExp(reUnescapedHtml.source),htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};module.exports=escape},{"lodash._basetostring":2}],2:[function(require,module){function baseToString(value){return"string"==typeof value?value:null==value?"":value+""}module.exports=baseToString},{}],3:[function(require,module){function arrayCopy(source,array){var index=-1,length=source.length;for(array||(array=Array(length));++index<length;)array[index]=source[index];return array}module.exports=arrayCopy},{}],4:[function(require,module){function arrayEach(array,iteratee){for(var index=-1,length=array.length;++index<length&&iteratee(array[index],index,array)!==!1;);return array}module.exports=arrayEach},{}],5:[function(require,module){function assignDefaults(objectValue,sourceValue){return"undefined"==typeof objectValue?sourceValue:objectValue}module.exports=assignDefaults},{}],6:[function(require,module){function baseAssign(object,source,customizer){var props=keys(source);if(!customizer)return baseCopy(source,object,props);for(var index=-1,length=props.length;++index<length;){var key=props[index],value=object[key],result=customizer(value,source[key],key,object,source);(result===result?result===value:value!==value)&&("undefined"!=typeof value||key in object)||(object[key]=result)}return object}var baseCopy=require("./baseCopy"),keys=require("../object/keys");module.exports=baseAssign},{"../object/keys":38,"./baseCopy":7}],7:[function(require,module){function baseCopy(source,object,props){props||(props=object,object={});for(var index=-1,length=props.length;++index<length;){var key=props[index];object[key]=source[key]}return object}module.exports=baseCopy},{}],8:[function(require,module){function baseFlatten(array,isDeep,isStrict,fromIndex){for(var index=(fromIndex||0)-1,length=array.length,resIndex=-1,result=[];++index<length;){var value=array[index];if(isObjectLike(value)&&isLength(value.length)&&(isArray(value)||isArguments(value))){isDeep&&(value=baseFlatten(value,isDeep,isStrict));var valIndex=-1,valLength=value.length;for(result.length+=valLength;++valIndex<valLength;)result[++resIndex]=value[valIndex]}else isStrict||(result[++resIndex]=value)}return result}var isArguments=require("../lang/isArguments"),isArray=require("../lang/isArray"),isLength=require("./isLength"),isObjectLike=require("./isObjectLike");module.exports=baseFlatten},{"../lang/isArguments":28,"../lang/isArray":29,"./isLength":21,"./isObjectLike":22}],9:[function(require,module){function baseFor(object,iteratee,keysFunc){for(var index=-1,iterable=toObject(object),props=keysFunc(object),length=props.length;++index<length;){var key=props[index];if(iteratee(iterable[key],key,iterable)===!1)break}return object}var toObject=require("./toObject");module.exports=baseFor},{"./toObject":27}],10:[function(require,module){function baseForIn(object,iteratee){return baseFor(object,iteratee,keysIn)}var baseFor=require("./baseFor"),keysIn=require("../object/keysIn");module.exports=baseForIn},{"../object/keysIn":39,"./baseFor":9}],11:[function(require,module){function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys)}var baseFor=require("./baseFor"),keys=require("../object/keys");module.exports=baseForOwn},{"../object/keys":38,"./baseFor":9}],12:[function(require,module){function baseIsFunction(value){return"function"==typeof value||!1}module.exports=baseIsFunction},{}],13:[function(require,module){function baseMerge(object,source,customizer,stackA,stackB){if(!isObject(object))return object;var isSrcArr=isLength(source.length)&&(isArray(source)||isTypedArray(source));return(isSrcArr?arrayEach:baseForOwn)(source,function(srcValue,key,source){if(isObjectLike(srcValue))return stackA||(stackA=[]),stackB||(stackB=[]),baseMergeDeep(object,source,key,baseMerge,customizer,stackA,stackB);var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):void 0,isCommon="undefined"==typeof result;isCommon&&(result=srcValue),!isSrcArr&&"undefined"==typeof result||!isCommon&&(result===result?result===value:value!==value)||(object[key]=result)}),object}var arrayEach=require("./arrayEach"),baseForOwn=require("./baseForOwn"),baseMergeDeep=require("./baseMergeDeep"),isArray=require("../lang/isArray"),isLength=require("./isLength"),isObject=require("../lang/isObject"),isObjectLike=require("./isObjectLike"),isTypedArray=require("../lang/isTypedArray");module.exports=baseMerge},{"../lang/isArray":29,"../lang/isObject":32,"../lang/isTypedArray":34,"./arrayEach":4,"./baseForOwn":11,"./baseMergeDeep":14,"./isLength":21,"./isObjectLike":22}],14:[function(require,module){function baseMergeDeep(object,source,key,mergeFunc,customizer,stackA,stackB){for(var length=stackA.length,srcValue=source[key];length--;)if(stackA[length]==srcValue)return void(object[key]=stackB[length]);var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):void 0,isCommon="undefined"==typeof result;isCommon&&(result=srcValue,isLength(srcValue.length)&&(isArray(srcValue)||isTypedArray(srcValue))?result=isArray(value)?value:value?arrayCopy(value):[]:isPlainObject(srcValue)||isArguments(srcValue)?result=isArguments(value)?toPlainObject(value):isPlainObject(value)?value:{}:isCommon=!1),stackA.push(srcValue),stackB.push(result),isCommon?object[key]=mergeFunc(result,srcValue,customizer,stackA,stackB):(result===result?result!==value:value===value)&&(object[key]=result)}var arrayCopy=require("./arrayCopy"),isArguments=require("../lang/isArguments"),isArray=require("../lang/isArray"),isLength=require("./isLength"),isPlainObject=require("../lang/isPlainObject"),isTypedArray=require("../lang/isTypedArray"),toPlainObject=require("../lang/toPlainObject");module.exports=baseMergeDeep},{"../lang/isArguments":28,"../lang/isArray":29,"../lang/isPlainObject":33,"../lang/isTypedArray":34,"../lang/toPlainObject":35,"./arrayCopy":3,"./isLength":21}],15:[function(require,module){function baseToString(value){return"string"==typeof value?value:null==value?"":value+""}module.exports=baseToString},{}],16:[function(require,module){function baseValues(object,props){for(var index=-1,length=props.length,result=Array(length);++index<length;)result[index]=object[props[index]];return result}module.exports=baseValues},{}],17:[function(require,module){function bindCallback(func,thisArg,argCount){if("function"!=typeof func)return identity;if("undefined"==typeof thisArg)return func;switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}var identity=require("../utility/identity");module.exports=bindCallback},{"../utility/identity":45}],18:[function(require,module){function createAssigner(assigner){return function(){var length=arguments.length,object=arguments[0];if(2>length||null==object)return object;if(length>3&&isIterateeCall(arguments[1],arguments[2],arguments[3])&&(length=2),length>3&&"function"==typeof arguments[length-2])var customizer=bindCallback(arguments[--length-1],arguments[length--],5);else length>2&&"function"==typeof arguments[length-1]&&(customizer=arguments[--length]);for(var index=0;++index<length;){var source=arguments[index];source&&assigner(object,source,customizer)}return object}}var bindCallback=require("./bindCallback"),isIterateeCall=require("./isIterateeCall");module.exports=createAssigner},{"./bindCallback":17,"./isIterateeCall":20}],19:[function(require,module){function isIndex(value,length){return value=+value,length=null==length?MAX_SAFE_INTEGER:length,value>-1&&value%1==0&&length>value}var MAX_SAFE_INTEGER=Math.pow(2,53)-1;module.exports=isIndex},{}],20:[function(require,module){function isIterateeCall(value,index,object){if(!isObject(object))return!1;var type=typeof index;if("number"==type)var length=object.length,prereq=isLength(length)&&isIndex(index,length);else prereq="string"==type&&index in object;if(prereq){var other=object[index];return value===value?value===other:other!==other}return!1}var isIndex=require("./isIndex"),isLength=require("./isLength"),isObject=require("../lang/isObject");module.exports=isIterateeCall},{"../lang/isObject":32,"./isIndex":19,"./isLength":21}],21:[function(require,module){function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&MAX_SAFE_INTEGER>=value}var MAX_SAFE_INTEGER=Math.pow(2,53)-1;module.exports=isLength},{}],22:[function(require,module){function isObjectLike(value){return value&&"object"==typeof value||!1}module.exports=isObjectLike},{}],23:[function(require,module){function pickByArray(object,props){object=toObject(object);for(var index=-1,length=props.length,result={};++index<length;){var key=props[index];key in object&&(result[key]=object[key])}return result}var toObject=require("./toObject");module.exports=pickByArray},{"./toObject":27}],24:[function(require,module){function pickByCallback(object,predicate){var result={};return baseForIn(object,function(value,key,object){predicate(value,key,object)&&(result[key]=value)}),result}var baseForIn=require("./baseForIn");module.exports=pickByCallback},{"./baseForIn":10}],25:[function(require,module){function shimIsPlainObject(value){var Ctor;if(!isObjectLike(value)||objToString.call(value)!=objectTag||!hasOwnProperty.call(value,"constructor")&&(Ctor=value.constructor,"function"==typeof Ctor&&!(Ctor instanceof Ctor)))return!1;var result;return baseForIn(value,function(subValue,key){result=key}),"undefined"==typeof result||hasOwnProperty.call(value,result)}var baseForIn=require("./baseForIn"),isObjectLike=require("./isObjectLike"),objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objToString=objectProto.toString;module.exports=shimIsPlainObject},{"./baseForIn":10,"./isObjectLike":22}],26:[function(require,module){function shimKeys(object){for(var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length,allowIndexes=length&&isLength(length)&&(isArray(object)||support.nonEnumArgs&&isArguments(object)),index=-1,result=[];++index<propsLength;){var key=props[index];(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key))&&result.push(key)}return result}var isArguments=require("../lang/isArguments"),isArray=require("../lang/isArray"),isIndex=require("./isIndex"),isLength=require("./isLength"),keysIn=require("../object/keysIn"),support=require("../support"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=shimKeys},{"../lang/isArguments":28,"../lang/isArray":29,"../object/keysIn":39,"../support":44,"./isIndex":19,"./isLength":21}],27:[function(require,module){function toObject(value){return isObject(value)?value:Object(value)}var isObject=require("../lang/isObject");module.exports=toObject},{"../lang/isObject":32}],28:[function(require,module){function isArguments(value){var length=isObjectLike(value)?value.length:void 0;return isLength(length)&&objToString.call(value)==argsTag||!1}var isLength=require("../internal/isLength"),isObjectLike=require("../internal/isObjectLike"),argsTag="[object Arguments]",objectProto=Object.prototype,objToString=objectProto.toString;module.exports=isArguments},{"../internal/isLength":21,"../internal/isObjectLike":22}],29:[function(require,module){var isLength=require("../internal/isLength"),isNative=require("./isNative"),isObjectLike=require("../internal/isObjectLike"),arrayTag="[object Array]",objectProto=Object.prototype,objToString=objectProto.toString,nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray,isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag||!1};module.exports=isArray},{"../internal/isLength":21,"../internal/isObjectLike":22,"./isNative":31}],30:[function(require,module){(function(global){var baseIsFunction=require("../internal/baseIsFunction"),isNative=require("./isNative"),funcTag="[object Function]",objectProto=Object.prototype,objToString=objectProto.toString,Uint8Array=isNative(Uint8Array=global.Uint8Array)&&Uint8Array,isFunction=baseIsFunction(/x/)||Uint8Array&&!baseIsFunction(Uint8Array)?function(value){return objToString.call(value)==funcTag}:baseIsFunction;module.exports=isFunction}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../internal/baseIsFunction":12,"./isNative":31}],31:[function(require,module){function isNative(value){return null==value?!1:objToString.call(value)==funcTag?reNative.test(fnToString.call(value)):isObjectLike(value)&&reHostCtor.test(value)||!1}var escapeRegExp=require("../string/escapeRegExp"),isObjectLike=require("../internal/isObjectLike"),funcTag="[object Function]",reHostCtor=/^\[object .+?Constructor\]$/,objectProto=Object.prototype,fnToString=Function.prototype.toString,objToString=objectProto.toString,reNative=RegExp("^"+escapeRegExp(objToString).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");module.exports=isNative},{"../internal/isObjectLike":22,"../string/escapeRegExp":43}],32:[function(require,module){function isObject(value){var type=typeof value;return"function"==type||value&&"object"==type||!1}module.exports=isObject},{}],33:[function(require,module){var isNative=require("./isNative"),shimIsPlainObject=require("../internal/shimIsPlainObject"),objectTag="[object Object]",objectProto=Object.prototype,objToString=objectProto.toString,getPrototypeOf=isNative(getPrototypeOf=Object.getPrototypeOf)&&getPrototypeOf,isPlainObject=getPrototypeOf?function(value){if(!value||objToString.call(value)!=objectTag)return!1;var valueOf=value.valueOf,objProto=isNative(valueOf)&&(objProto=getPrototypeOf(valueOf))&&getPrototypeOf(objProto);return objProto?value==objProto||getPrototypeOf(value)==objProto:shimIsPlainObject(value)}:shimIsPlainObject;module.exports=isPlainObject},{"../internal/shimIsPlainObject":25,"./isNative":31}],34:[function(require,module){function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&typedArrayTags[objToString.call(value)]||!1}var isLength=require("../internal/isLength"),isObjectLike=require("../internal/isObjectLike"),argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var objectProto=Object.prototype,objToString=objectProto.toString;module.exports=isTypedArray},{"../internal/isLength":21,"../internal/isObjectLike":22}],35:[function(require,module){function toPlainObject(value){return baseCopy(value,keysIn(value))}var baseCopy=require("../internal/baseCopy"),keysIn=require("../object/keysIn");module.exports=toPlainObject},{"../internal/baseCopy":7,"../object/keysIn":39}],36:[function(require,module){var baseAssign=require("../internal/baseAssign"),createAssigner=require("../internal/createAssigner"),assign=createAssigner(baseAssign);module.exports=assign},{"../internal/baseAssign":6,"../internal/createAssigner":18}],37:[function(require,module){function defaults(object){if(null==object)return object;var args=arrayCopy(arguments);return args.push(assignDefaults),assign.apply(void 0,args)}var arrayCopy=require("../internal/arrayCopy"),assign=require("./assign"),assignDefaults=require("../internal/assignDefaults");module.exports=defaults},{"../internal/arrayCopy":3,"../internal/assignDefaults":5,"./assign":36}],38:[function(require,module){var isLength=require("../internal/isLength"),isNative=require("../lang/isNative"),isObject=require("../lang/isObject"),shimKeys=require("../internal/shimKeys"),nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,keys=nativeKeys?function(object){if(object)var Ctor=object.constructor,length=object.length;return"function"==typeof Ctor&&Ctor.prototype===object||"function"!=typeof object&&length&&isLength(length)?shimKeys(object):isObject(object)?nativeKeys(object):[]}:shimKeys;module.exports=keys},{"../internal/isLength":21,"../internal/shimKeys":26,"../lang/isNative":31,"../lang/isObject":32}],39:[function(require,module){function keysIn(object){if(null==object)return[];isObject(object)||(object=Object(object));var length=object.length;length=length&&isLength(length)&&(isArray(object)||support.nonEnumArgs&&isArguments(object))&&length||0;for(var Ctor=object.constructor,index=-1,isProto="function"==typeof Ctor&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;++index<length;)result[index]=index+"";for(var key in object)skipIndexes&&isIndex(key,length)||"constructor"==key&&(isProto||!hasOwnProperty.call(object,key))||result.push(key);return result}var isArguments=require("../lang/isArguments"),isArray=require("../lang/isArray"),isIndex=require("../internal/isIndex"),isLength=require("../internal/isLength"),isObject=require("../lang/isObject"),support=require("../support"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=keysIn},{"../internal/isIndex":19,"../internal/isLength":21,"../lang/isArguments":28,"../lang/isArray":29,"../lang/isObject":32,"../support":44}],40:[function(require,module){var baseMerge=require("../internal/baseMerge"),createAssigner=require("../internal/createAssigner"),merge=createAssigner(baseMerge);module.exports=merge},{"../internal/baseMerge":13,"../internal/createAssigner":18}],41:[function(require,module){function pick(object,predicate,thisArg){return null==object?{}:"function"==typeof predicate?pickByCallback(object,bindCallback(predicate,thisArg,3)):pickByArray(object,baseFlatten(arguments,!1,!1,1))}var baseFlatten=require("../internal/baseFlatten"),bindCallback=require("../internal/bindCallback"),pickByArray=require("../internal/pickByArray"),pickByCallback=require("../internal/pickByCallback");module.exports=pick},{"../internal/baseFlatten":8,"../internal/bindCallback":17,"../internal/pickByArray":23,"../internal/pickByCallback":24}],42:[function(require,module){function values(object){return baseValues(object,keys(object))}var baseValues=require("../internal/baseValues"),keys=require("./keys");module.exports=values},{"../internal/baseValues":16,"./keys":38}],43:[function(require,module){function escapeRegExp(string){return string=baseToString(string),string&&reHasRegExpChars.test(string)?string.replace(reRegExpChars,"\\$&"):string}var baseToString=require("../internal/baseToString"),reRegExpChars=/[.*+?^${}()|[\]\/\\]/g,reHasRegExpChars=RegExp(reRegExpChars.source);module.exports=escapeRegExp},{"../internal/baseToString":15}],44:[function(require,module){(function(global){var isNative=require("./lang/isNative"),reThis=/\bthis\b/,objectProto=Object.prototype,document=(document=global.window)&&document.document,propertyIsEnumerable=objectProto.propertyIsEnumerable,support={};!function(){support.funcDecomp=!isNative(global.WinRTError)&&reThis.test(function(){return this}),support.funcNames="string"==typeof Function.name;try{support.dom=11===document.createDocumentFragment().nodeType}catch(e){support.dom=!1}try{support.nonEnumArgs=!propertyIsEnumerable.call(arguments,1)}catch(e){support.nonEnumArgs=!0}}(0,0),module.exports=support}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lang/isNative":31}],45:[function(require,module){function identity(value){return value}module.exports=identity},{}],46:[function(require,module,exports){!function(){function loopKeys(expr){var ret={val:expr},els=expr.split(/\s+in\s+/);return els[1]&&(ret.val=brackets(0)+els[1],els=els[0].slice(brackets(0).length).trim().split(/,\s*/),ret.key=els[0],ret.pos=els[1]),ret}function mkitem(expr,key,val){var item={};return item[expr.key]=key,expr.pos&&(item[expr.pos]=val),item}function _each(dom,parent,expr){function add(pos,item,tag){rendered.splice(pos,0,item),tags.splice(pos,0,tag)}remAttr(dom,"each");var checksum,template=dom.outerHTML,prev=dom.previousSibling,root=dom.parentNode,rendered=[],tags=[];expr=loopKeys(expr),parent.one("update",function(){root.removeChild(dom)}).one("premount",function(){root.stub&&(root=parent.root)}).on("update",function(){var items=tmpl(expr.val,parent);if(items){if(!Array.isArray(items)){var testsum=JSON.stringify(items);if(testsum==checksum)return;checksum=testsum,each(tags,function(tag){tag.unmount()}),rendered=[],tags=[],items=Object.keys(items).map(function(key){return mkitem(expr,key,items[key])})}each(arrDiff(rendered,items),function(item){var pos=rendered.indexOf(item),tag=tags[pos];tag&&(tag.unmount(),rendered.splice(pos,1),tags.splice(pos,1))});var nodes=root.childNodes,prev_index=[].indexOf.call(nodes,prev);each(items,function(item,i){var pos=items.indexOf(item,i),oldPos=rendered.indexOf(item,i);if(0>pos&&(pos=items.lastIndexOf(item,i)),0>oldPos&&(oldPos=rendered.lastIndexOf(item,i)),0>oldPos){!checksum&&expr.key&&(item=mkitem(expr,item,pos));var tag=new Tag({tmpl:template},{before:nodes[prev_index+1+pos],parent:parent,root:root,loop:!0,item:item});return add(pos,item,tag)}return expr.pos&&tags[oldPos][expr.pos]!=pos&&(tags[oldPos].one("update",function(item){item[expr.pos]=pos}),tags[oldPos].update()),pos!=oldPos?(root.insertBefore(nodes[prev_index+oldPos+1],nodes[prev_index+pos+1]),add(pos,rendered.splice(oldPos,1)[0],tags.splice(oldPos,1)[0])):void 0}),rendered=items.slice()}})}function parseNamedElements(root,tag){walk(root,function(dom){1==dom.nodeType&&each(dom.attributes,function(attr){/^(name|id)$/.test(attr.name)&&(tag[attr.value]=dom)})})}function parseLayout(root,tag,expressions){function addExpr(dom,val,extra){if(val.indexOf(brackets(0))>=0){var expr={dom:dom,expr:val};expressions.push(extend(expr,extra))}}walk(root,function(dom){var type=dom.nodeType;if(3==type&&"STYLE"!=dom.parentNode.tagName&&addExpr(dom,dom.nodeValue),1==type){var attr=dom.getAttribute("each");if(attr)return _each(dom,tag,attr),!1;each(dom.attributes,function(attr){var name=attr.name,bool=name.split("__")[1];return addExpr(dom,attr.value,{attr:bool||name,bool:bool}),bool?(remAttr(dom,name),!1):void 0});var impl=tag_impl[dom.tagName.toLowerCase()];return impl?(impl=new Tag(impl,{root:dom,parent:tag}),!1):void 0}})}function Tag(impl,conf){function updateOpts(){each(Object.keys(attr),function(name){opts[name]=tmpl(attr[name],parent||self)})}function mount(){if(self.trigger("premount"),is_loop)loop_dom=dom.firstChild,root.insertBefore(loop_dom,conf.before||null);else for(;dom.firstChild;)root.appendChild(dom.firstChild);root.stub&&(self.root=root=parent.root),parent&&parent.on("update",self.update).one("unmount",self.unmount),self.trigger("mount")}var loop_dom,self=riot.observable(this),opts=inherit(conf.opts)||{},dom=mkdom(impl.tmpl),parent=conf.parent,is_loop=conf.loop,expressions=[],root=conf.root,item=conf.item,attr={};extend(this,{parent:parent,root:root,opts:opts},item),each(root.attributes,function(el){attr[el.name]=el.value}),this.update=function(data){extend(self,data,item),updateOpts(),self.trigger("update",item),update(expressions,self,item),self.trigger("updated")},this.unmount=function(){var el=is_loop?loop_dom:root,p=el.parentNode;if(p){if(parent)p.removeChild(el);else for(;root.firstChild;)root.removeChild(root.firstChild);self.trigger("unmount"),parent&&parent.off("update",self.update).off("unmount",self.unmount),self.off("*")}},updateOpts(),parseNamedElements(dom,this),impl.fn&&impl.fn.call(this,opts),parseLayout(dom,this,expressions),this.update(),mount()}function setEventHandler(name,handler,dom,tag,item){dom[name]=function(e){e=e||window.event,e.which=e.which||e.charCode||e.keyCode,e.target=e.target||e.srcElement,e.currentTarget=dom,e.item=item,handler.call(tag,e)!==!0&&(e.preventDefault&&e.preventDefault(),e.returnValue=!1);var el=item?tag.parent:tag;el.update()}}function insertTo(root,node,before){root&&(root.insertBefore(before,node),root.removeChild(node))}function update(expressions,tag,item){each(expressions,function(expr){var dom=expr.dom,attr_name=expr.attr,value=tmpl(expr.expr,tag);if(null==value&&(value=""),expr.value!==value){if(expr.value=value,!attr_name)return dom.nodeValue=value;if(remAttr(dom,attr_name),"function"==typeof value)setEventHandler(attr_name,value,dom,tag,item);else if("if"==attr_name){var stub=expr.stub;value?stub&&insertTo(stub.parentNode,stub,dom):(stub=expr.stub=stub||document.createTextNode(""),insertTo(dom.parentNode,dom,stub))}else if(/^(show|hide)$/.test(attr_name))"hide"==attr_name&&(value=!value),dom.style.display=value?"":"none";else if("value"==attr_name)dom.value=value;else if("riot"==attr_name.slice(0,4))attr_name=attr_name.slice(5),value?dom.setAttribute(attr_name,value):remAttr(dom,attr_name);else{if(expr.bool){if(dom[attr_name]=value,!value)return;value=attr_name}"object"!=typeof value&&dom.setAttribute(attr_name,value)}}})}function each(els,fn){for(var el,i=0,len=(els||[]).length;len>i;i++)el=els[i],null!=el&&fn(el,i)===!1&&i--;return els}function remAttr(dom,name){dom.removeAttribute(name)}function extend(obj,from,from2){return from&&each(Object.keys(from),function(key){obj[key]=from[key]}),from2?extend(obj,from2):obj}function mkdom(template){var tag_name=template.trim().slice(1,3).toLowerCase(),root_tag=/td|th/.test(tag_name)?"tr":"tr"==tag_name?"tbody":"div",el=document.createElement(root_tag);return el.stub=!0,el.innerHTML=template,el}function walk(dom,fn){if(dom)if(fn(dom)===!1)walk(dom.nextSibling,fn);else for(dom=dom.firstChild;dom;)walk(dom,fn),dom=dom.nextSibling}function arrDiff(arr1,arr2){return arr1.filter(function(el){return arr2.indexOf(el)<0})}function inherit(parent){function Child(){}return Child.prototype=parent,new Child}function injectStyle(css){var node=document.createElement("style");node.innerHTML=css,document.head.appendChild(node)}function mountTo(root,tagName,opts){var tag=tag_impl[tagName];return tag&&root?(tag=new Tag(tag,{root:root,opts:opts}),virtual_dom.push(tag),tag.on("unmount",function(){virtual_dom.splice(virtual_dom.indexOf(tag),1)})):void 0}var riot={version:"v2.0.11",settings:{}};riot.observable=function(el){el=el||{};var callbacks={},_id=0;return el.on=function(events,fn){return"function"==typeof fn&&(fn._id="undefined"==typeof fn._id?_id++:fn._id,events.replace(/\S+/g,function(name,pos){(callbacks[name]=callbacks[name]||[]).push(fn),fn.typed=pos>0})),el},el.off=function(events,fn){return"*"==events?callbacks={}:events.replace(/\S+/g,function(name){if(fn)for(var cb,arr=callbacks[name],i=0;cb=arr&&arr[i];++i)cb._id==fn._id&&(arr.splice(i,1),i--);else callbacks[name]=[]}),el},el.one=function(name,fn){return fn&&(fn.one=1),el.on(name,fn)},el.trigger=function(name){for(var fn,args=[].slice.call(arguments,1),fns=callbacks[name]||[],i=0;fn=fns[i];++i)fn.busy||(fn.busy=1,fn.apply(el,fn.typed?[name].concat(args):args),fn.one?(fns.splice(i,1),i--):fns[i]!==fn&&i--,fn.busy=0);return el},el},function(riot,evt){function hash(){return loc.hash.slice(1)}function parser(path){return path.split("/")}function emit(path){path.type&&(path=hash()),path!=current&&(fns.trigger.apply(null,["H"].concat(parser(path))),current=path)}if(this.top){var current,loc=location,fns=riot.observable(),win=window,r=riot.route=function(arg){arg[0]?(loc.hash=arg,emit(arg)):fns.on("H",arg)};r.exec=function(fn){fn.apply(null,parser(hash()))},r.parser=function(fn){parser=fn},win.addEventListener?win.addEventListener(evt,emit,!1):win.attachEvent("on"+evt,emit)}}(riot,"hashchange");var brackets=function(orig,s,b){return function(x){return s=riot.settings.brackets||orig,b!=s&&(b=s.split(" ")),x&&x.test?s==orig?x:RegExp(x.source.replace(/\{/g,b[0].replace(/(?=.)/g,"\\")).replace(/\}/g,b[1].replace(/(?=.)/g,"\\")),x.global?"g":""):b[x]}}("{ }"),tmpl=function(){function tmpl(s,p){return p=(s||brackets(0)+brackets(1)).replace(brackets(/\\{/),"￰").replace(brackets(/\\}/),"￱").split(brackets(re_expr)),new Function("d","return "+(p[0]||p[2]||p[3]?"["+p.map(function(s,i){return i%2?expr(s,1):'"'+s.replace(/\n/g,"\\n").replace(/"/g,'\\"')+'"'}).join(",")+'].join("")':expr(p[1])).replace(/\uFFF0/g,brackets(0)).replace(/\uFFF1/g,brackets(1))+";")}function expr(s,n){return s=s.replace(/\n/g," ").replace(brackets(/^[{ ]+|[ }]+$|\/\*.+?\*\//g),""),/^\s*[\w- "']+ *:/.test(s)?"["+s.replace(/\W*([\w- ]+)\W*:([^,]+)/g,function(_,k,v){return v.replace(/[^&|=!><]+/g,wrap)+'?"'+k.trim()+'":"",'})+'].join(" ")':wrap(s,n)}function wrap(s,nonull){return s=s.trim(),s?"(function(v){try{v="+(s.replace(re_vars,function(s,_,v){return v?"(d."+v+"===undefined?window."+v+":d."+v+")":s})||"x")+"}finally{return "+(nonull?'!v&&v!==0?"":v':"v")+"}}).call(d)":""}var cache={},re_expr=/({[\s\S]*?})/,re_vars=/(['"\/]).*?[^\\]\1|\.\w*|\w*:|\b(?:(?:new|typeof|in|instanceof) |(?:this|true|false|null|undefined)\b|function *\()|([a-z_]\w*)/gi;return function(str,data){return str&&(cache[str]=cache[str]||tmpl(str))(data)}}(),virtual_dom=[],tag_impl={};riot.tag=function(name,html,css,fn){"function"==typeof css?fn=css:css&&injectStyle(css),tag_impl[name]={name:name,tmpl:html,fn:fn}},riot.mount=function(selector,tagName,opts){function push(root){var name=tagName||root.tagName.toLowerCase(),tag=mountTo(root,name,opts);tag&&tags.push(tag)}"*"==selector&&(selector=Object.keys(tag_impl).join(", ")),"object"==typeof tagName&&(opts=tagName,tagName=0);var tags=[];return selector.tagName?(push(selector),tags[0]):(each(document.querySelectorAll(selector),push),tags)},riot.update=function(){return each(virtual_dom,function(tag){tag.update()})},riot.mountTo=riot.mount,riot.util={brackets:brackets,tmpl:tmpl},"object"==typeof exports?module.exports=riot:"function"==typeof define&&define.amd?define(function(){return riot}):this.riot=riot}()},{}],47:[function(require,module){function Post(opts,key){this.setattr(_.defaults({},opts,{key:key},Post.defaults))}function favsAndLastestUpdater(post){var f=fbref,pst="posts/"+post.key,fav="favorited/"+post.key,usf="user_favorites/"+post.uid+"/"+post.key,atr=_.merge(post.getattr(),{date:post.date.valueOf()});
post.destroyed?(f.child(fav).remove(),f.child(pst).remove(),f.child(usf).remove()):(f.child(pst).set(atr),post.favorited?(f.child(fav).set(atr),f.child(usf).set(atr)):(f.child(fav).remove(),f.child(usf).remove()))}var _={defaults:require("lodash/object/defaults"),merge:require("lodash/object/merge"),pick:require("lodash/object/pick")},fbref=new Firebase("https://musifavs.firebaseio.com"),timeago=require("../lib/fromnow"),yt=require("../lib/youtube");Post.defaults={date:void 0,desc:"",embed:{},favorited:!1,key:null,stored:!1,title:"",uid:void 0,userName:void 0},Post.prototype.toggleFav=function(){this.favorited=!this.favorited},Post.prototype.equals=function(other){return this.key===other.key},Post.prototype.toString=function(){return JSON.stringify(_.pick(this.getattr(),["title","key"]))},Post.prototype.getattr=function(){return _.pick(this,Object.keys(Post.defaults))},Post.prototype.setattr=function(opts){_.merge(this,opts);var p=this;return this.stored=void 0!==p.key,this.date=p.date?new Date(p.date):new Date,!p.embed||p.embed.type&&"unknown"!=p.embed.type||(this.embed=yt.extractEmbed(p.embed.url)),this},Post.prototype.validation=function(){var p=this,r={errors:[],isValid:!0};return!p.date instanceof Date&&(r.errors.date="date is invalid",r.isValid=!1),p.title&&0!=p.title.length||(r.errors.title="title can't be blank",r.isValid=!1),p.embed&&p.embed.type||(r.errors.url="the embed url is invalid",r.isValid=!1),r},Post.prototype.timeago=function(){return timeago(this.date)},Post.prototype.fbrootref=function(){return fbref.child("user_posts/"+this.uid)},Post.prototype.fbpostref=function(){return this.fbrootref().child("/"+this.key)},require("riot").observable(Post),Post.destroy=function(post){post.fbpostref().remove(function(error){error||(post.destroyed=!0,Post.trigger("store:posts:did:destroy",post))})};var listeners={};Post.retrieve=function(collection){if(!listeners[collection]){var ref=fbref.child(collection).orderByPriority();listeners[collection]=ref.on("child_added",function(snapshot){var post=new Post(snapshot.val(),snapshot.key());Post.trigger("store:posts:did:retrieve",collection,post)})}},Post.stopRetrieve=function(collection){listeners[collection]&&(fbref.off("child_added",listeners[collection]),delete listeners[collection])},Post.latest=function(collection){var r=fbref.child(collection).orderByPriority().limitToFirst(10);console.log(collection),r.once("value",function(snapshot){var data=snapshot.val();if(data){var latest=Object.keys(data).reduce(function(acc,key){return acc.push(new Post(data[key],key)),acc},[]).sort(function(post1,post2){return post2.date-post1.date});Post.trigger("store:posts:did:latest",collection,latest)}})},Post.persist=function(post){var date=new Date,attrs=_.merge(post.getattr(),{date:date.valueOf(),uid:post.uid}),r=post.fbrootref().push(attrs,function(error){error?Post.trigger("store:posts:failed:persist",post,error):(post.setattr({key:r.key(),date:date}),Post.trigger("store:posts:did:persist",post),r.setPriority(date.valueOf()))})},Post.update=function(post){post.fbpostref().update(post.getattr(),function(error){error?Post.trigger("store:posts:failed:update",post,error):Post.trigger("store:posts:did:update",post)})},Post.on("store:posts:did:persist",favsAndLastestUpdater),Post.on("store:posts:did:update",favsAndLastestUpdater),Post.on("store:posts:did:destroy",favsAndLastestUpdater),module.exports=Post},{"../lib/fromnow":50,"../lib/youtube":51,"lodash/object/defaults":37,"lodash/object/merge":40,"lodash/object/pick":41,riot:46}],48:[function(require,module){function User(opts,uid){_.defaults(this,opts,User.defaults),User.current&&User.current.uid===uid&&_.defaults(this,User.current)}function updateAuth(authData){if(authData){var u=User.current;if(u.uid=authData.uid,u.authData=authData,u.provider=authData.provider,u.logged=!0,"twitter"==authData.provider){u.displayName=authData.twitter.displayName;var p=authData.twitter.cachedUserProfile;p&&(u.avatarUrl=p.profile_image_url_https,u.description=p.description,u.location=p.location,u.url=p.url)}_.defaults(this,u.defaults)}}var _={defaults:require("lodash/object/defaults"),pick:require("lodash/object/pick")},fbref=new Firebase("https://musifavs.firebaseio.com");User.defaults={avatarUrl:"/assets/profile.png",description:"MusiFavs! user",displayName:"user",location:"Universe",logged:!1,url:"https://musifavs.com"},User.prototype.getattr=function(){return _.pick(this,User.attributes)},User.prototype.logout=function(){this.authData=null,this.logged=!1,this.provider="unknown",this.uid=null},User.prototype.update=function(){this.uid&&fbref.child("users").child(this.uid).set(user.getattr())},User.prototype.toString=function(){return JSON.stringify(_.pick(this.getattr(),["displayName","logged"]))},require("riot").observable(User),User.login=function(provider){fbref.authWithOAuthPopup(provider,function(error,authData){error||!authData?User.trigger("store:users:failed:login",error||{code:"unknown"}):updateAuth(authData)})},User.logout=function(){User.current&&User.current.logged&&(User.current.logout(),fbref.unauth())},User.lookup=function(uid){fbref.child("users").child(uid).once("value",function(snapshot){var data=snapshot.val();data?User.trigger("store:users:did:lookup",uid,new User(data,uid)):User.trigger("store:users:failed:lookup",uid)})},User.setupCurrent=function(){User.current=new User,fbref.onAuth(function(authData){authData?(updateAuth(authData),User.trigger("store:users:did:login",User.current,authData)):(User.current.logout(),User.trigger("store:users:did:logout",User.current))})},module.exports=User},{"lodash/object/defaults":37,"lodash/object/pick":41,riot:46}],49:[function(require,module){function DomWrap(node,selector){this[0]=this.node=node,this.id=node.id,selector&&(this.node=node.querySelector(selector)),this.listeners=[]}var _={isFunction:require("lodash/lang/isFunction")};DomWrap.prototype.html=function(html){return this.node.innerHTML=html,this},DomWrap.prototype.prepend=function(node){return this.node.insertBefore(node,this.node.firstChild),this},DomWrap.prototype.text=function(text){return this.node.textContent=text,this},DomWrap.prototype.val=function(){return arguments.length&&(this.node.value=arguments[0]),this.node.value},DomWrap.prototype.addClass=function(classname){return this.node.classList.add(classname),this},DomWrap.prototype.removeClass=function(classname){return this.node.classList.remove(classname),this},DomWrap.prototype.parent=function(selector){for(var t=this.node.parentElement;t;){if(t.matches(selector))return new DomWrap(t);t=t.parentElement}},DomWrap.prototype.data=function(name){return this.node.getAttribute("data-"+name)},DomWrap.prototype.on=function(eventname,selector,callback){var fn,n=this.node;return _.isFunction(selector)?(callback=selector,fn=function(ev){ev.preventDefault(),callback(new DomWrap(ev.target),ev)}):fn=function(ev){ev.preventDefault();for(var i,c,t=ev.target,candidates=n.querySelectorAll(selector),length=candidates.length;t;){for(i=0;length>i;i++)if(c=candidates[i],c.isEqualNode(t))return callback(new DomWrap(c),ev);if(t.isEqualNode(n))return;t=t.parentElement}},n.addEventListener(eventname,fn),this.listeners.push({eventname:eventname,fn:fn}),this},DomWrap.prototype.off=function(eventname,callback){return arguments.length?this.node.removeEventListener(eventname,callback):(this.listeners.forEach(function(data){this.node.removeEventListener(data.eventname,data.fn)},this),this.listeners=[]),this},module.exports=function(node,selector){return new DomWrap(node,selector)}},{"lodash/lang/isFunction":30}],50:[function(require,module){module.exports=function(date){var between=(Date.now()-date)/1e3;return 0>between?"recently":3600>between?~~(between/60)+" minutes ago":86400>between?~~(between/3600)+" hours ago":~~(between/86400)+" days ago"}},{}],51:[function(require,module,exports){var urlregex=/youtube.com.+\?v=([a-zA-z0-9\-_]+)/i;exports.extractEmbed=function(url){var match=urlregex.exec(url);return match&&match.length?{type:"youtube",url:url,videoId:match[1]}:{type:"unknown",url:url}}},{}],52:[function(require){require("./app/user").setupCurrent();var Message=require("./modules/message/message"),Navigation=require("./modules/navigation/navigation"),Main=require("./modules/main/main"),main=new Main(document.querySelector("#app-main")),riot=(new Message(main,document.querySelector("#app-message")),new Navigation(main,document.querySelector("#app-navigation")),require("riot")),router=main.router.bind(main);riot.route(router),riot.route.exec(router)},{"./app/user":48,"./modules/main/main":58,"./modules/message/message":60,"./modules/navigation/navigation":62,riot:46}],53:[function(require,module,exports){({escape:require("lodash.escape")});module.exports=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<main class="main app-front" role="main"><img class="responsive-width" src="/assets/music.jpg"><div class="front-copy"><h1>A micro Blog for your favorite Music!</h1><p>Share your favorite music and videos with your friends.<br>With MusiFavs you can embed content from YouTube, SoundCloud, and more, in a single place!</p><h2>Latest Posts</h2><ul class="post-list latest-posts"></ul><h2>Latest Favorited</h2><ul class="post-list latest-favs"></ul></div></main>';return __p}},{"lodash.escape":1}],54:[function(require,module){function Front(parent,node,options){node.innerHTML=template(options),this.parent=parent,this.nodes={root:$(node),posts:$(node,".latest-posts"),favorited:$(node,".latest-favs")},this.handlePosts=function(collection,posts){this.nodes[collection].html(itemstpl({posts:posts}))}.bind(this),Post.on("store:posts:did:latest",this.handlePosts),Post.latest("posts"),Post.latest("favorited")}var $=require("../../lib/domWrap"),Post=require("../../app/post"),itemstpl=require("./post-items.html"),template=require("./front.html");Front.prototype.unload=function(){this.nodes.root.html(""),Post.off("store:posts:did:latest",this.handlePosts)},module.exports=Front},{"../../app/post":47,"../../lib/domWrap":49,"./front.html":53,"./post-items.html":55}],55:[function(require,module,exports){({escape:require("lodash.escape")});module.exports=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",posts.forEach(function(post){__p+='<li><i class="fa fa-play"></i>&nbsp;'+(null==(__t=post.title)?"":__t)+' posted by&nbsp; <a href="#'+(null==(__t=post.uid)?"":__t)+'/posts">'+(null==(__t=post.userName)?"":__t)+'&nbsp;<i class="fa fa-child"></i></a> &nbsp; <span class="timeago">('+(null==(__t=post.timeago())?"":__t)+")</span></li>"}),__p+="";return __p}},{"lodash.escape":1}],56:[function(require,module,exports){({escape:require("lodash.escape")});module.exports=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<main class="main" role="main"><div class="front-copy"><h1>Log In</h1><p>In order to interact with MusiFavs! you\'ll need to log in first.</p><p>Please select one of the services below to log in:</p><ul class="login-links fa-ul fa-2x"><li><i class="fa-li fa fa-twitter-square"></i> <a href="#" id="twitter-login">Twitter</a></li><li><i class="fa-li fa fa-google-plus-square"></i> <a href="#" id="google-login">Google</a> <small>(Sorry, unavailable at the moment)</small></li><li><i class="fa-li fa fa-facebook-square"></i> <a href="#" id="facebook-login">Facebook</a> <small>(Sorry, unavailable at the moment)</small></li></ul></div></main>';return __p}},{"lodash.escape":1}],57:[function(require,module){function Login(parent,node,options){node.innerHTML=template(options),this.parent=parent,this.nodes={root:$(node),list:$(node,".login-links")},this.loginListener=function(target){if("twitter-login"==target.id)User.login("twitter");else{var p=this.parent;p.message("Sorry, authenticating with this provider is not available yet.")}}.bind(this),this.nodes.list.on("click",this.loginListener)}var $=require("../../lib/domWrap"),User=require("../../app/user"),template=require("./login.html");Login.prototype.unload=function(){this.nodes.list.off("click",this.loginListener),this.nodes.root.html("")},module.exports=Login},{"../../app/user":48,"../../lib/domWrap":49,"./login.html":56}],58:[function(require,module){function Main(rootNode){riot.observable(this),this.rootNode=rootNode,User.on("store:users:did:login",function(user){this.message("Thank you! You have been logged in."),user.update()}.bind(this)),User.on("store:users:did:update",function(user){this.router(user.uid,"posts")}.bind(this)),User.on("store:users:did:logout",function(){window.location.hash="",this.message("You've been logged out.")}.bind(this)),User.on("module:user:failed:mount",function(){window.location.hash="",this.message("Sorry, we could not find that user.")}.bind(this))}var User=require("../../app/user"),riot=require("riot");require("../front/front"),require("../login/login"),require("../user/user"),Main.prototype.message=function(text){this.trigger("module:main:do:message",text)},Main.prototype.loadmod=function(modname,options){this.lastmod&&this.lastmod.unload();var ctor=require("../"+modname+"/"+modname);this.lastmod=new ctor(this,this.rootNode,options)},Main.prototype.newPost=function(){nav.on("module:navigation:did:newpost",function(){"me/posts"!=window.location.hash&&(window.location.hash="me/posts/new")})},Main.prototype.router=function(_uid,action,postid){this.trigger("module:main:did:router");var user=User.current,uid="me"==_uid?user.uid:_uid;switch(action){case"posts":case"favorites":"me"!=_uid||user.logged?(this.loadmod("user",{user:user.uid==uid?user:null,uid:uid,action:action}),"new"==postid&&this.lastmod.showNewPost()):(this.loadmod("login"),this.message("Please login to access your posts."));break;case"logout":user.logged?User.loggout():window.location.hash="";break;default:this.loadmod("front")}},module.exports=Main},{"../../app/user":48,"../front/front":54,"../login/login":57,"../user/user":69,riot:46}],59:[function(require,module,exports){({escape:require("lodash.escape")});module.exports=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<span class="app-message-text"></span><div class="app-message-dismiss"><a href="#" class="app-message-dismiss">Dismiss</a></div>';return __p}},{"lodash.escape":1}],60:[function(require,module){function Message(parent,node,options){node.innerHTML=template(options),this.parent=parent,this.nodes={root:$(node),text:$(node,".app-message-text"),dism:$(node,".app-message-dismiss")},this.mainDoMessageListener=function(text){this.show(text)}.bind(this),this.parent.on("module:main:do:message",this.mainDoMessageListener),this.nodes.dism.on("click",function(){this.dismiss()}.bind(this))}var $=require("../../lib/domWrap"),template=require("./message.html");Message.prototype.unload=function(){this.parent.off("module:main:do:message",this.mainDoMessageListener),this.nodes.dism.off(),this.nodes.root.html("")},Message.prototype.show=function(message){this.nodes.root.removeClass("app-hidden"),this.nodes.text.text(message)},Message.prototype.dismiss=function(){this.nodes.root.addClass("app-hidden"),this.nodes.text.text("")},module.exports=Message},{"../../lib/domWrap":49,"./message.html":59}],61:[function(require,module,exports){({escape:require("lodash.escape")});module.exports=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<nav class="navigation"><ul class="nav-actions" role="navigation"><li><a id="nav-newpost" href="#">New Post</a></li><li><a href="#me/posts">My Posts</a></li><li><a href="#me/favorites">My Favorites</a></li><li><a id="nav-logout" href="#me/logout">Log Out</a></li></ul></nav>';return __p}},{"lodash.escape":1}],62:[function(require,module){function Navigation(parent,node,options){node.innerHTML=template(options),this.parent=parent,this.nodes={root:$(node),logout:$(node,"#nav-logout"),newpost:$(node,"#nav-newpost")};var user=User.current;this.updateLogout=function(){user.logged?this.showLogout():this.hideLogout()}.bind(this),this.parent.on("module:main:did:router",this.updateLogout),this.newpostListener=function(ev){ev.preventDefault(),this.trigger("module:navigation:did:newpost")}.bind(this),this.nodes.newpost.on("click",this.newpostListener)}var $=require("../../lib/domWrap"),User=require("../../app/user"),template=(require("riot"),require("./navigation.html"));Navigation.prototype.unload=function(){this.parent.off("module:main:did:router",this.updateLogout),this.nodes.newpost.on("click",this.newpostListener),this.nodes.root.html("")},Navigation.prototype.showLogout=function(){this.nodes.logout.removeClass("app-hidden")},Navigation.prototype.hideLogout=function(){this.nodes.logout.addClass("app-hidden")},module.exports=Navigation},{"../../app/user":48,"../../lib/domWrap":49,"./navigation.html":61,riot:46}],63:[function(require,module,exports){({escape:require("lodash.escape")});module.exports=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="<h2>"+(null==(__t=stored?"Editing Post":"New Post")?"":__t)+'</h2><p>Please provide the resource url to share, a title and a description.</p><div class="post-form-embed"><label>Embed Url (e.g. YouTube Url)</label><input name="url" type="url" placeholder="https://www.youtube.com/watch?v=P9J5tYShNY8"></div><div class="post-form-data"><input name="title" title="Post Title" type="text" placeholder="Title"><textarea title="Post Description" placeholder="Description"></textarea></div><div class="post-actions" data-post-key="'+(null==(__t=postKey)?"":__t)+'"><a class="undo" title="Undo" href="#"><i class="fa fa-times-circle"></i>&nbsp;Cancel</a> <a class="save" title="Save and Publish" href="#"><i class="fa fa-save"></i>&nbsp;Save</a> <span class="post-edit-message"></span></div>';return __p}},{"lodash.escape":1}],64:[function(require,module){function PostForm(parent,node,options){this.parent=parent,this.post=new Post(options.post);var r=$(node).html(template(_.merge({postKey:this.post.key||"new"},this.post)));this.nodes={root:r,formMessage:$(node,".post-edit-message"),inputTitle:$(node,"input[name=title]"),inputUrl:$(node,"input[name=url]"),inputDesc:$(node,"textarea")},r.addClass("app-post-form"),this.updateForm()}var _={merge:require("lodash/object/merge"),values:require("lodash/object/values")},$=require("../../lib/domWrap"),Post=require("../../app/post"),template=require("./form.html");PostForm.prototype.unload=function(){this.nodes.root.removeClass("app-post-form").html("")},PostForm.prototype.updateForm=function(){var n=this.nodes,p=this.post;n.inputTitle.val(p.title),n.inputUrl.val(p.embed.url||""),n.inputDesc.val(p.desc)},PostForm.prototype.updatePost=function(){var n=this.nodes;this.post.setattr({title:n.inputTitle.val(),embed:{url:n.inputUrl.val()},desc:n.inputDesc.val()})},PostForm.prototype.isValid=function(){var result=this.post.validation(),n=this.nodes;if(n.inputUrl.removeClass("invalid"),n.inputTitle.removeClass("invalid"),result.isValid)return!0;result.errors.url&&n.inputUrl.addClass("invalid"),result.errors.title&&n.inputTitle.addClass("invalid");var msg=_.values(result.errors).join(", ");return n.formMessage.text("Sorry, the post can't be saved: "+msg+"."),!1},module.exports=PostForm},{"../../app/post":47,"../../lib/domWrap":49,"./form.html":63,"lodash/object/merge":40,"lodash/object/values":42}],65:[function(require,module,exports){({escape:require("lodash.escape")});module.exports=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<p class="timeago">posted by&nbsp;'+(null==(__t=displayName)?"":__t)+"&nbsp;"+(null==(__t=timeago)?"":__t)+'</p><h2><i class="fa fa-play"></i>&nbsp;'+(null==(__t=title)?"":__t)+'</h2><div class="post-show-embed"><iframe type="text/html" width="640" height="260" src="http://www.youtube.com/embed/'+(null==(__t=embed.videoId)?"":__t)+'" frameborder="0"></iframe></div><p class="post-show-description"><i class="fa fa-child fa-2x"></i>&nbsp;'+(null==(__t=desc)?"":__t)+'</p><div class="post-actions" data-post-key="'+(null==(__t=postKey)?"":__t)+'"><a class="fav" title="Favorite" href="#"><i class="fa fa-heart"></i>&nbsp;Favorite</a> <a class="edit" title="Edit" href="#"><i class="fa fa-edit"></i>&nbsp;Edit</a> <a class="remove" title="Remove" href="#"><i class="fa fa-trash"></i>&nbsp;Remove</a></div>';return __p}},{"lodash.escape":1}],66:[function(require,module){function PostShow(parent,node,options){this.parent=parent;var p=this.post=options.post;node.innerHTML=template(_.merge(p.getattr(),{postKey:p.key||"new",timeago:p.timeago(),displayName:options.displayName})),this.nodes={root:$(node).addClass("app-post-show"),fav:$(node,".fav")},this.updateFav()}var $=require("../../lib/domWrap"),template=require("./show.html"),_={merge:require("lodash/object/merge")};PostShow.prototype.updateFav=function(){var p=this.post,f=this.nodes.fav;p.favorited?f.addClass("post-favorited"):f.removeClass("post-favorited")},PostShow.prototype.unload=function(){this.nodes.root.removeClass("app-post-show").html("")},module.exports=PostShow},{"../../lib/domWrap":49,"./show.html":65,"lodash/object/merge":40}],67:[function(require,module,exports){({escape:require("lodash.escape")});module.exports=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="profile-info"><ul class="fa-ul"><li class="profile-pic"><img src="'+(null==(__t=user.avatarUrl)?"":__t)+'"></li><li><i class="fa-li fa fa-link"></i> <a href="'+(null==(__t=user.url)?"":__t)+'">'+(null==(__t=user.displayName)?"":__t)+'</a><br></li><li><i class="fa-li fa fa-user"></i>'+(null==(__t=user.description)?"":__t)+'</li><li><i class="fa-li fa fa-map-marker"></i>'+(null==(__t=user.location)?"":__t)+'</li><li><i class="fa-li fa fa-twitter-square"></i> <a href="https://twitter.com/'+(null==(__t=user.displayName)?"":__t)+'">@'+(null==(__t=user.displayName)?"":__t)+"</a></li></ul></div>";return __p}},{"lodash.escape":1}],68:[function(require,module,exports){({escape:require("lodash.escape")});module.exports=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<aside class="profile"></aside><main class="main" role="main"><div class="app-new-post"></div><div class="app-post-placeholder"><h1>Hey!&nbsp;<i class="fa fa-child"></i>&nbsp;<i class="fa fa-play"></i></h1><p>This user has not'+(null==(__t="posts"==action?" posted anything ":" favorited any post ")?"":__t)+'yet. Please check back later!</p></div><div class="app-posts"></div></main>';return __p}},{"lodash.escape":1}],69:[function(require,module){function UserMod(parent,node,options){this.parent=parent,this.mods={},this.action=options.action,this.uid=options.uid,this.user=options.user,this.firebasepath="user_"+this.action+"/"+this.user.uid,node.innerHTML=template(this);var r=$(node);this.nodes={root:r,newpost:$(node,".app-new-post"),placehold:$(node,".app-post-placeholder"),posts:$(node,".app-posts"),prof:$(node,".profile")},this.userFailedLookup=function(uid){this.parent.trigger("module:user:failed:mount",uid)}.bind(this),this.userDidLookup=function(uid,user){this.user=user,this.redrawProfile(),Post.retrieve(this.firebasepath)}.bind(this),this.postsDidRetrieve=function(firebasepath,post){var u=this,m=this.mods[post.key];m?u.showmod(m):u.addPost(post)}.bind(this),this.postsDidUpdate=function(post){var u=this,m=this.mods[post.key];m&&u.showmod(m)}.bind(this);var actionMod=function(target){var key=target.parent(".post-actions").data("post-key");return this.mods[key]}.bind(this);r.on("click",".fav",function(target){var mod=actionMod(target);mod.post.toggleFav(),Post.update(mod.post)}.bind(this)),r.on("click",".edit",function(target){var mod=actionMod(target);this.editPost(mod)}.bind(this)),r.on("click",".remove",function(target){var mod=actionMod(target);this.removePost(mod)}.bind(this)),r.on("click",".undo",function(target){var mod=actionMod(target);mod.post.stored?this.showmod(mod):this.hideNewPost()}.bind(this)),r.on("click",".save",function(target){var mod=actionMod(target);mod.updatePost(),mod.isValid()&&(mod.post.stored?Post.update(mod.post):(Post.persist(mod.post),this.hideNewPost()))}.bind(this)),User.on("store:users:failed:lookup",this.userFailedLookup),User.on("store:users:did:lookup",this.userDidLookup),Post.on("store:posts:did:retrieve",this.postsDidRetrieve),Post.on("store:posts:did:update",this.postsDidUpdate),User.lookup(this.uid)}var $=require("../../lib/domWrap"),Post=require("../../app/post"),User=require("../../app/user"),PostForm=require("../post/form"),PostShow=require("../post/show"),proftpl=require("./profile.html"),template=require("./user.html");UserMod.prototype.unload=function(){this.nodes.root.off().html(""),User.off("store:users:failed:lookup",this.userFailedLookup),User.off("store:users:did:lookup",this.userDidLookup),Post.off("store:posts:did:retrieve",this.postsDidRetrieve),Post.off("store:posts:did:update",this.postsDidUpdate),Post.stopRetrieve(this.firebasepath)},UserMod.prototype.updatePlaceholder=function(){var modkeys=Object.keys(this.mods),p=this.nodes.placehold;0==modkeys.length||"new"==modkeys[0]?p.removeClass("app-hidden"):p.addClass("app-hidden")},UserMod.prototype.redrawProfile=function(){this.nodes.prof.html(proftpl(this))},UserMod.prototype.hideNewPost=function(){var m=this.mods["new"],n=this.nodes.newpost;m&&(m.unload(),n.remove(m.nodes.root[0]),delete this.mods["new"],this.updatePlaceholder())},UserMod.prototype.showNewPost=function(){if(!this.mods["new"]){var el=document.createElement("div"),p=new Post({uid:this.uid,userName:this.user.displayName});this.mods["new"]=new PostForm(this,el,{post:p}),this.nodes.newpost.appendChild(el),this.updatePlaceholder()}},UserMod.prototype.editPost=function(mod){var el=mod.nodes.root[0];mod.unload(),this.mods[mod.post.key]=new PostForm(this,el,{post:mod.post})},UserMod.prototype.addPost=function(post){var el=document.createElement("div"),p=new PostShow(this,el,{post:post,displayName:this.user.displayName});this.mods[post.key]=p,this.nodes.posts.prepend(p.nodes.root[0]),this.updatePlaceholder()},UserMod.prototype.showmod=function(mod){if(mod instanceof PostForm){mod.unload();var m=new PostShow(this,mod.nodes.root[0],{post:mod.post,displayName:this.user.displayName});this.mods[mod.post.key]=m}else mod.updateFav()},UserMod.prototype.removePost=function(mod){Post.destroy(mod.post),mod.unload(),this.nodes.posts.remove(mod.nodes.root[0]),delete this.mods[mod.key],this.updatePlaceholder()},module.exports=UserMod},{"../../app/post":47,"../../app/user":48,"../../lib/domWrap":49,"../post/form":64,"../post/show":66,"./profile.html":67,"./user.html":68}]},{},[52]);