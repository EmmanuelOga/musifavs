(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var baseToString=require("lodash._basetostring");var reUnescapedHtml=/[&<>"'`]/g,reHasUnescapedHtml=RegExp(reUnescapedHtml.source);var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};function escapeHtmlChar(chr){return htmlEscapes[chr]}function escape(string){string=baseToString(string);return string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}module.exports=escape},{"lodash._basetostring":2}],2:[function(require,module,exports){function baseToString(value){if(typeof value=="string"){return value}return value==null?"":value+""}module.exports=baseToString},{}],3:[function(require,module,exports){var arrayFilter=require("../internal/arrayFilter"),baseCallback=require("../internal/baseCallback"),baseFilter=require("../internal/baseFilter"),isArray=require("../lang/isArray");function reject(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;predicate=baseCallback(predicate,thisArg,3);return func(collection,function(value,index,collection){return!predicate(value,index,collection)})}module.exports=reject},{"../internal/arrayFilter":6,"../internal/baseCallback":9,"../internal/baseFilter":12,"../lang/isArray":47}],4:[function(require,module,exports){function arrayCopy(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}module.exports=arrayCopy},{}],5:[function(require,module,exports){function arrayEach(array,iteratee){var index=-1,length=array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}module.exports=arrayEach},{}],6:[function(require,module,exports){function arrayFilter(array,predicate){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[++resIndex]=value}}return result}module.exports=arrayFilter},{}],7:[function(require,module,exports){function assignDefaults(objectValue,sourceValue){return typeof objectValue=="undefined"?sourceValue:objectValue}module.exports=assignDefaults},{}],8:[function(require,module,exports){var baseCopy=require("./baseCopy"),keys=require("../object/keys");function baseAssign(object,source,customizer){var props=keys(source);if(!customizer){return baseCopy(source,object,props)}var index=-1,length=props.length;while(++index<length){var key=props[index],value=object[key],result=customizer(value,source[key],key,object,source);if((result===result?result!==value:value===value)||typeof value=="undefined"&&!(key in object)){object[key]=result}}return object}module.exports=baseAssign},{"../object/keys":56,"./baseCopy":10}],9:[function(require,module,exports){var baseMatches=require("./baseMatches"),baseMatchesProperty=require("./baseMatchesProperty"),baseProperty=require("./baseProperty"),bindCallback=require("./bindCallback"),identity=require("../utility/identity"),isBindable=require("./isBindable");function baseCallback(func,thisArg,argCount){var type=typeof func;if(type=="function"){return typeof thisArg!="undefined"&&isBindable(func)?bindCallback(func,thisArg,argCount):func}if(func==null){return identity}if(type=="object"){return baseMatches(func)}return typeof thisArg=="undefined"?baseProperty(func+""):baseMatchesProperty(func+"",thisArg)}module.exports=baseCallback},{"../utility/identity":63,"./baseMatches":21,"./baseMatchesProperty":22,"./baseProperty":25,"./bindCallback":29,"./isBindable":34}],10:[function(require,module,exports){function baseCopy(source,object,props){if(!props){props=object;object={}}var index=-1,length=props.length;while(++index<length){var key=props[index];object[key]=source[key]}return object}module.exports=baseCopy},{}],11:[function(require,module,exports){var baseForOwn=require("./baseForOwn"),isLength=require("./isLength"),toObject=require("./toObject");function baseEach(collection,iteratee){var length=collection?collection.length:0;if(!isLength(length)){return baseForOwn(collection,iteratee)}var index=-1,iterable=toObject(collection);while(++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}module.exports=baseEach},{"./baseForOwn":16,"./isLength":37,"./toObject":45}],12:[function(require,module,exports){var baseEach=require("./baseEach");function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value)}});return result}module.exports=baseFilter},{"./baseEach":11}],13:[function(require,module,exports){var isArguments=require("../lang/isArguments"),isArray=require("../lang/isArray"),isLength=require("./isLength"),isObjectLike=require("./isObjectLike");function baseFlatten(array,isDeep,isStrict,fromIndex){var index=(fromIndex||0)-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];if(isObjectLike(value)&&isLength(value.length)&&(isArray(value)||isArguments(value))){if(isDeep){value=baseFlatten(value,isDeep,isStrict)}var valIndex=-1,valLength=value.length;result.length+=valLength;while(++valIndex<valLength){result[++resIndex]=value[valIndex]}}else if(!isStrict){result[++resIndex]=value}}return result}module.exports=baseFlatten},{"../lang/isArguments":46,"../lang/isArray":47,"./isLength":37,"./isObjectLike":38}],14:[function(require,module,exports){var toObject=require("./toObject");function baseFor(object,iteratee,keysFunc){var index=-1,iterable=toObject(object),props=keysFunc(object),length=props.length;while(++index<length){var key=props[index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}module.exports=baseFor},{"./toObject":45}],15:[function(require,module,exports){var baseFor=require("./baseFor"),keysIn=require("../object/keysIn");function baseForIn(object,iteratee){return baseFor(object,iteratee,keysIn)}module.exports=baseForIn},{"../object/keysIn":57,"./baseFor":14}],16:[function(require,module,exports){var baseFor=require("./baseFor"),keys=require("../object/keys");function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys)}module.exports=baseForOwn},{"../object/keys":56,"./baseFor":14}],17:[function(require,module,exports){var baseIsEqualDeep=require("./baseIsEqualDeep");function baseIsEqual(value,other,customizer,isWhere,stackA,stackB){if(value===other){return value!==0||1/value==1/other}var valType=typeof value,othType=typeof other;if(valType!="function"&&valType!="object"&&othType!="function"&&othType!="object"||value==null||other==null){return value!==value&&other!==other}return baseIsEqualDeep(value,other,baseIsEqual,customizer,isWhere,stackA,stackB)}module.exports=baseIsEqual},{"./baseIsEqualDeep":18}],18:[function(require,module,exports){var equalArrays=require("./equalArrays"),equalByTag=require("./equalByTag"),equalObjects=require("./equalObjects"),isArray=require("../lang/isArray"),isTypedArray=require("../lang/isTypedArray");var argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]";var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;function baseIsEqualDeep(object,other,equalFunc,customizer,isWhere,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=objToString.call(object);if(objTag==argsTag){objTag=objectTag}else if(objTag!=objectTag){objIsArr=isTypedArray(object)}}if(!othIsArr){othTag=objToString.call(other);if(othTag==argsTag){othTag=objectTag}else if(othTag!=objectTag){othIsArr=isTypedArray(other)}}var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!(objIsArr||objIsObj)){return equalByTag(object,other,objTag)}var valWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(valWrapped||othWrapped){return equalFunc(valWrapped?object.value():object,othWrapped?other.value():other,customizer,isWhere,stackA,stackB)}if(!isSameTag){return false}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==object){return stackB[length]==other}}stackA.push(object);stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,isWhere,stackA,stackB);stackA.pop();stackB.pop();return result}module.exports=baseIsEqualDeep},{"../lang/isArray":47,"../lang/isTypedArray":52,"./equalArrays":31,"./equalByTag":32,"./equalObjects":33}],19:[function(require,module,exports){function baseIsFunction(value){return typeof value=="function"||false}module.exports=baseIsFunction},{}],20:[function(require,module,exports){var baseIsEqual=require("./baseIsEqual");var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function baseIsMatch(object,props,values,strictCompareFlags,customizer){var length=props.length;if(object==null){return!length}var index=-1,noCustomizer=!customizer;while(++index<length){if(noCustomizer&&strictCompareFlags[index]?values[index]!==object[props[index]]:!hasOwnProperty.call(object,props[index])){return false}}index=-1;while(++index<length){var key=props[index];if(noCustomizer&&strictCompareFlags[index]){var result=hasOwnProperty.call(object,key)}else{var objValue=object[key],srcValue=values[index];result=customizer?customizer(objValue,srcValue,key):undefined;if(typeof result=="undefined"){result=baseIsEqual(srcValue,objValue,customizer,true)}}if(!result){return false}}return true}module.exports=baseIsMatch},{"./baseIsEqual":17}],21:[function(require,module,exports){var baseIsMatch=require("./baseIsMatch"),isStrictComparable=require("./isStrictComparable"),keys=require("../object/keys");var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function baseMatches(source){var props=keys(source),length=props.length;if(length==1){var key=props[0],value=source[key];if(isStrictComparable(value)){return function(object){return object!=null&&object[key]===value&&hasOwnProperty.call(object,key)}}}var values=Array(length),strictCompareFlags=Array(length);while(length--){value=source[props[length]];values[length]=value;strictCompareFlags[length]=isStrictComparable(value)}return function(object){return baseIsMatch(object,props,values,strictCompareFlags)}}module.exports=baseMatches},{"../object/keys":56,"./baseIsMatch":20,"./isStrictComparable":39}],22:[function(require,module,exports){var baseIsEqual=require("./baseIsEqual"),isStrictComparable=require("./isStrictComparable");function baseMatchesProperty(key,value){if(isStrictComparable(value)){return function(object){return object!=null&&object[key]===value}}return function(object){return object!=null&&baseIsEqual(value,object[key],null,true)}}module.exports=baseMatchesProperty},{"./baseIsEqual":17,"./isStrictComparable":39}],23:[function(require,module,exports){var arrayEach=require("./arrayEach"),baseForOwn=require("./baseForOwn"),baseMergeDeep=require("./baseMergeDeep"),isArray=require("../lang/isArray"),isLength=require("./isLength"),isObject=require("../lang/isObject"),isObjectLike=require("./isObjectLike"),isTypedArray=require("../lang/isTypedArray");function baseMerge(object,source,customizer,stackA,stackB){if(!isObject(object)){return object}var isSrcArr=isLength(source.length)&&(isArray(source)||isTypedArray(source));(isSrcArr?arrayEach:baseForOwn)(source,function(srcValue,key,source){if(isObjectLike(srcValue)){stackA||(stackA=[]);stackB||(stackB=[]);return baseMergeDeep(object,source,key,baseMerge,customizer,stackA,stackB)}var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=typeof result=="undefined";if(isCommon){result=srcValue}if((isSrcArr||typeof result!="undefined")&&(isCommon||(result===result?result!==value:value===value))){object[key]=result}});return object}module.exports=baseMerge},{"../lang/isArray":47,"../lang/isObject":50,"../lang/isTypedArray":52,"./arrayEach":5,"./baseForOwn":16,"./baseMergeDeep":24,"./isLength":37,"./isObjectLike":38}],24:[function(require,module,exports){var arrayCopy=require("./arrayCopy"),isArguments=require("../lang/isArguments"),isArray=require("../lang/isArray"),isLength=require("./isLength"),isPlainObject=require("../lang/isPlainObject"),isTypedArray=require("../lang/isTypedArray"),toPlainObject=require("../lang/toPlainObject");function baseMergeDeep(object,source,key,mergeFunc,customizer,stackA,stackB){var length=stackA.length,srcValue=source[key];while(length--){if(stackA[length]==srcValue){object[key]=stackB[length];return}}var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=typeof result=="undefined";if(isCommon){result=srcValue;if(isLength(srcValue.length)&&(isArray(srcValue)||isTypedArray(srcValue))){result=isArray(value)?value:value?arrayCopy(value):[]}else if(isPlainObject(srcValue)||isArguments(srcValue)){result=isArguments(value)?toPlainObject(value):isPlainObject(value)?value:{}}else{isCommon=false}}stackA.push(srcValue);stackB.push(result);if(isCommon){object[key]=mergeFunc(result,srcValue,customizer,stackA,stackB)}else if(result===result?result!==value:value===value){object[key]=result}}module.exports=baseMergeDeep},{"../lang/isArguments":46,"../lang/isArray":47,"../lang/isPlainObject":51,"../lang/isTypedArray":52,"../lang/toPlainObject":53,"./arrayCopy":4,"./isLength":37}],25:[function(require,module,exports){function baseProperty(key){return function(object){return object==null?undefined:object[key]}}module.exports=baseProperty},{}],26:[function(require,module,exports){var identity=require("../utility/identity"),metaMap=require("./metaMap");var baseSetData=!metaMap?identity:function(func,data){metaMap.set(func,data);return func};module.exports=baseSetData},{"../utility/identity":63,"./metaMap":40}],27:[function(require,module,exports){function baseToString(value){if(typeof value=="string"){return value}return value==null?"":value+""}module.exports=baseToString},{}],28:[function(require,module,exports){function baseValues(object,props){var index=-1,length=props.length,result=Array(length);while(++index<length){result[index]=object[props[index]]}return result}module.exports=baseValues},{}],29:[function(require,module,exports){var identity=require("../utility/identity");function bindCallback(func,thisArg,argCount){if(typeof func!="function"){return identity}if(typeof thisArg=="undefined"){return func}switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}module.exports=bindCallback},{"../utility/identity":63}],30:[function(require,module,exports){var bindCallback=require("./bindCallback"),isIterateeCall=require("./isIterateeCall");function createAssigner(assigner){return function(){var length=arguments.length,object=arguments[0];if(length<2||object==null){return object}if(length>3&&isIterateeCall(arguments[1],arguments[2],arguments[3])){length=2}if(length>3&&typeof arguments[length-2]=="function"){var customizer=bindCallback(arguments[--length-1],arguments[length--],5)}else if(length>2&&typeof arguments[length-1]=="function"){customizer=arguments[--length]}var index=0;while(++index<length){var source=arguments[index];if(source){assigner(object,source,customizer)}}return object}}module.exports=createAssigner},{"./bindCallback":29,"./isIterateeCall":36}],31:[function(require,module,exports){function equalArrays(array,other,equalFunc,customizer,isWhere,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length,result=true;if(arrLength!=othLength&&!(isWhere&&othLength>arrLength)){return false}while(result&&++index<arrLength){var arrValue=array[index],othValue=other[index];result=undefined;if(customizer){result=isWhere?customizer(othValue,arrValue,index):customizer(arrValue,othValue,index)}if(typeof result=="undefined"){if(isWhere){var othIndex=othLength;while(othIndex--){othValue=other[othIndex];result=arrValue&&arrValue===othValue||equalFunc(arrValue,othValue,customizer,isWhere,stackA,stackB);if(result){break}}}else{result=arrValue&&arrValue===othValue||equalFunc(arrValue,othValue,customizer,isWhere,stackA,stackB)}}}return!!result}module.exports=equalArrays},{}],32:[function(require,module,exports){var boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",numberTag="[object Number]",regexpTag="[object RegExp]",stringTag="[object String]";function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==0?1/object==1/other:object==+other;case regexpTag:case stringTag:return object==other+""}return false}module.exports=equalByTag},{}],33:[function(require,module,exports){var keys=require("../object/keys");var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function equalObjects(object,other,equalFunc,customizer,isWhere,stackA,stackB){var objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isWhere){return false}var hasCtor,index=-1;while(++index<objLength){var key=objProps[index],result=hasOwnProperty.call(other,key);if(result){var objValue=object[key],othValue=other[key];result=undefined;if(customizer){result=isWhere?customizer(othValue,objValue,key):customizer(objValue,othValue,key)}if(typeof result=="undefined"){result=objValue&&objValue===othValue||equalFunc(objValue,othValue,customizer,isWhere,stackA,stackB)}}if(!result){return false}hasCtor||(hasCtor=key=="constructor")}if(!hasCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){return false}}return true}module.exports=equalObjects},{"../object/keys":56}],34:[function(require,module,exports){var baseSetData=require("./baseSetData"),isNative=require("../lang/isNative"),support=require("../support");var reFuncName=/^\s*function[ \n\r\t]+\w/;var reThis=/\bthis\b/;var fnToString=Function.prototype.toString;function isBindable(func){var result=!(support.funcNames?func.name:support.funcDecomp);if(!result){var source=fnToString.call(func);if(!support.funcNames){result=!reFuncName.test(source)}if(!result){result=reThis.test(source)||isNative(func);baseSetData(func,result)}}return result}module.exports=isBindable},{"../lang/isNative":49,"../support":62,"./baseSetData":26}],35:[function(require,module,exports){var MAX_SAFE_INTEGER=Math.pow(2,53)-1;function isIndex(value,length){value=+value;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length}module.exports=isIndex},{}],36:[function(require,module,exports){var isIndex=require("./isIndex"),isLength=require("./isLength"),isObject=require("../lang/isObject");function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"){var length=object.length,prereq=isLength(length)&&isIndex(index,length)}else{prereq=type=="string"&&index in object}if(prereq){var other=object[index];return value===value?value===other:other!==other}return false}module.exports=isIterateeCall},{"../lang/isObject":50,"./isIndex":35,"./isLength":37}],37:[function(require,module,exports){var MAX_SAFE_INTEGER=Math.pow(2,53)-1;function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}module.exports=isLength},{}],38:[function(require,module,exports){function isObjectLike(value){return value&&typeof value=="object"||false}module.exports=isObjectLike},{}],39:[function(require,module,exports){var isObject=require("../lang/isObject");function isStrictComparable(value){return value===value&&(value===0?1/value>0:!isObject(value))}module.exports=isStrictComparable},{"../lang/isObject":50}],40:[function(require,module,exports){(function(global){var isNative=require("../lang/isNative");var WeakMap=isNative(WeakMap=global.WeakMap)&&WeakMap;var metaMap=WeakMap&&new WeakMap;module.exports=metaMap}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../lang/isNative":49}],41:[function(require,module,exports){var toObject=require("./toObject");function pickByArray(object,props){object=toObject(object);var index=-1,length=props.length,result={};while(++index<length){var key=props[index];if(key in object){result[key]=object[key]}}return result}module.exports=pickByArray},{"./toObject":45}],42:[function(require,module,exports){var baseForIn=require("./baseForIn");function pickByCallback(object,predicate){var result={};baseForIn(object,function(value,key,object){if(predicate(value,key,object)){result[key]=value}});return result}module.exports=pickByCallback},{"./baseForIn":15}],43:[function(require,module,exports){var baseForIn=require("./baseForIn"),isObjectLike=require("./isObjectLike");var objectTag="[object Object]";var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;function shimIsPlainObject(value){var Ctor;if(!(isObjectLike(value)&&objToString.call(value)==objectTag)||!hasOwnProperty.call(value,"constructor")&&(Ctor=value.constructor,typeof Ctor=="function"&&!(Ctor instanceof Ctor))){return false}var result;baseForIn(value,function(subValue,key){result=key});return typeof result=="undefined"||hasOwnProperty.call(value,result)}module.exports=shimIsPlainObject},{"./baseForIn":15,"./isObjectLike":38}],44:[function(require,module,exports){var isArguments=require("../lang/isArguments"),isArray=require("../lang/isArray"),isIndex=require("./isIndex"),isLength=require("./isLength"),keysIn=require("../object/keysIn"),support=require("../support");var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function shimKeys(object){var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length;var allowIndexes=length&&isLength(length)&&(isArray(object)||support.nonEnumArgs&&isArguments(object));var index=-1,result=[];while(++index<propsLength){var key=props[index];if(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key)){result.push(key)}}return result}module.exports=shimKeys},{"../lang/isArguments":46,"../lang/isArray":47,"../object/keysIn":57,"../support":62,"./isIndex":35,"./isLength":37}],45:[function(require,module,exports){var isObject=require("../lang/isObject");function toObject(value){return isObject(value)?value:Object(value)}module.exports=toObject},{"../lang/isObject":50}],46:[function(require,module,exports){var isLength=require("../internal/isLength"),isObjectLike=require("../internal/isObjectLike");var argsTag="[object Arguments]";var objectProto=Object.prototype;var objToString=objectProto.toString;function isArguments(value){var length=isObjectLike(value)?value.length:undefined;return isLength(length)&&objToString.call(value)==argsTag||false}module.exports=isArguments},{"../internal/isLength":37,"../internal/isObjectLike":38}],47:[function(require,module,exports){var isLength=require("../internal/isLength"),isNative=require("./isNative"),isObjectLike=require("../internal/isObjectLike");var arrayTag="[object Array]";var objectProto=Object.prototype;var objToString=objectProto.toString;var nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray;var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag||false};module.exports=isArray},{"../internal/isLength":37,"../internal/isObjectLike":38,"./isNative":49}],48:[function(require,module,exports){(function(global){var baseIsFunction=require("../internal/baseIsFunction"),isNative=require("./isNative");var funcTag="[object Function]";var objectProto=Object.prototype;var objToString=objectProto.toString;var Uint8Array=isNative(Uint8Array=global.Uint8Array)&&Uint8Array;var isFunction=!(baseIsFunction(/x/)||Uint8Array&&!baseIsFunction(Uint8Array))?baseIsFunction:function(value){return objToString.call(value)==funcTag};module.exports=isFunction}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../internal/baseIsFunction":19,"./isNative":49}],49:[function(require,module,exports){var escapeRegExp=require("../string/escapeRegExp"),isObjectLike=require("../internal/isObjectLike");var funcTag="[object Function]";var reHostCtor=/^\[object .+?Constructor\]$/;var objectProto=Object.prototype;var fnToString=Function.prototype.toString;var objToString=objectProto.toString;var reNative=RegExp("^"+escapeRegExp(objToString).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function isNative(value){if(value==null){return false}if(objToString.call(value)==funcTag){return reNative.test(fnToString.call(value))}return isObjectLike(value)&&reHostCtor.test(value)||false}module.exports=isNative},{"../internal/isObjectLike":38,"../string/escapeRegExp":61}],50:[function(require,module,exports){function isObject(value){var type=typeof value;return type=="function"||value&&type=="object"||false}module.exports=isObject},{}],51:[function(require,module,exports){var isNative=require("./isNative"),shimIsPlainObject=require("../internal/shimIsPlainObject");var objectTag="[object Object]";var objectProto=Object.prototype;var objToString=objectProto.toString;var getPrototypeOf=isNative(getPrototypeOf=Object.getPrototypeOf)&&getPrototypeOf;var isPlainObject=!getPrototypeOf?shimIsPlainObject:function(value){if(!(value&&objToString.call(value)==objectTag)){return false}var valueOf=value.valueOf,objProto=isNative(valueOf)&&(objProto=getPrototypeOf(valueOf))&&getPrototypeOf(objProto);return objProto?value==objProto||getPrototypeOf(value)==objProto:shimIsPlainObject(value)};module.exports=isPlainObject},{"../internal/shimIsPlainObject":43,"./isNative":49}],52:[function(require,module,exports){var isLength=require("../internal/isLength"),isObjectLike=require("../internal/isObjectLike");var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var objectProto=Object.prototype;var objToString=objectProto.toString;function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&typedArrayTags[objToString.call(value)]||false}module.exports=isTypedArray},{"../internal/isLength":37,"../internal/isObjectLike":38}],53:[function(require,module,exports){var baseCopy=require("../internal/baseCopy"),keysIn=require("../object/keysIn");function toPlainObject(value){return baseCopy(value,keysIn(value))}module.exports=toPlainObject},{"../internal/baseCopy":10,"../object/keysIn":57}],54:[function(require,module,exports){var baseAssign=require("../internal/baseAssign"),createAssigner=require("../internal/createAssigner");var assign=createAssigner(baseAssign);module.exports=assign},{"../internal/baseAssign":8,"../internal/createAssigner":30}],55:[function(require,module,exports){var arrayCopy=require("../internal/arrayCopy"),assign=require("./assign"),assignDefaults=require("../internal/assignDefaults");function defaults(object){if(object==null){return object}var args=arrayCopy(arguments);args.push(assignDefaults);return assign.apply(undefined,args)}module.exports=defaults},{"../internal/arrayCopy":4,"../internal/assignDefaults":7,"./assign":54}],56:[function(require,module,exports){var isLength=require("../internal/isLength"),isNative=require("../lang/isNative"),isObject=require("../lang/isObject"),shimKeys=require("../internal/shimKeys");var nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys;var keys=!nativeKeys?shimKeys:function(object){if(object){var Ctor=object.constructor,length=object.length}if(typeof Ctor=="function"&&Ctor.prototype===object||typeof object!="function"&&(length&&isLength(length))){return shimKeys(object)}return isObject(object)?nativeKeys(object):[]};module.exports=keys},{"../internal/isLength":37,"../internal/shimKeys":44,"../lang/isNative":49,"../lang/isObject":50}],57:[function(require,module,exports){var isArguments=require("../lang/isArguments"),isArray=require("../lang/isArray"),isIndex=require("../internal/isIndex"),isLength=require("../internal/isLength"),isObject=require("../lang/isObject"),support=require("../support");var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function keysIn(object){if(object==null){return[]}if(!isObject(object)){object=Object(object)}var length=object.length;length=length&&isLength(length)&&(isArray(object)||support.nonEnumArgs&&isArguments(object))&&length||0;var Ctor=object.constructor,index=-1,isProto=typeof Ctor=="function"&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;while(++index<length){result[index]=index+""}for(var key in object){if(!(skipIndexes&&isIndex(key,length))&&!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}module.exports=keysIn},{"../internal/isIndex":35,"../internal/isLength":37,"../lang/isArguments":46,"../lang/isArray":47,"../lang/isObject":50,"../support":62}],58:[function(require,module,exports){var baseMerge=require("../internal/baseMerge"),createAssigner=require("../internal/createAssigner");var merge=createAssigner(baseMerge);module.exports=merge},{"../internal/baseMerge":23,"../internal/createAssigner":30}],59:[function(require,module,exports){var baseFlatten=require("../internal/baseFlatten"),bindCallback=require("../internal/bindCallback"),pickByArray=require("../internal/pickByArray"),pickByCallback=require("../internal/pickByCallback");function pick(object,predicate,thisArg){if(object==null){return{}}return typeof predicate=="function"?pickByCallback(object,bindCallback(predicate,thisArg,3)):pickByArray(object,baseFlatten(arguments,false,false,1))}module.exports=pick},{"../internal/baseFlatten":13,"../internal/bindCallback":29,"../internal/pickByArray":41,"../internal/pickByCallback":42}],60:[function(require,module,exports){var baseValues=require("../internal/baseValues"),keys=require("./keys");
function values(object){return baseValues(object,keys(object))}module.exports=values},{"../internal/baseValues":28,"./keys":56}],61:[function(require,module,exports){var baseToString=require("../internal/baseToString");var reRegExpChars=/[.*+?^${}()|[\]\/\\]/g,reHasRegExpChars=RegExp(reRegExpChars.source);function escapeRegExp(string){string=baseToString(string);return string&&reHasRegExpChars.test(string)?string.replace(reRegExpChars,"\\$&"):string}module.exports=escapeRegExp},{"../internal/baseToString":27}],62:[function(require,module,exports){(function(global){var isNative=require("./lang/isNative");var reThis=/\bthis\b/;var objectProto=Object.prototype;var document=(document=global.window)&&document.document;var propertyIsEnumerable=objectProto.propertyIsEnumerable;var support={};(function(x){support.funcDecomp=!isNative(global.WinRTError)&&reThis.test(function(){return this});support.funcNames=typeof Function.name=="string";try{support.dom=document.createDocumentFragment().nodeType===11}catch(e){support.dom=false}try{support.nonEnumArgs=!propertyIsEnumerable.call(arguments,1)}catch(e){support.nonEnumArgs=true}})(0,0);module.exports=support}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./lang/isNative":49}],63:[function(require,module,exports){function identity(value){return value}module.exports=identity},{}],64:[function(require,module,exports){(function(){var riot={version:"v2.0.12",settings:{}};"use strict";riot.observable=function(el){el=el||{};var callbacks={},_id=0;el.on=function(events,fn){if(typeof fn=="function"){fn._id=typeof fn._id=="undefined"?_id++:fn._id;events.replace(/\S+/g,function(name,pos){(callbacks[name]=callbacks[name]||[]).push(fn);fn.typed=pos>0})}return el};el.off=function(events,fn){if(events=="*")callbacks={};else{events.replace(/\S+/g,function(name){if(fn){var arr=callbacks[name];for(var i=0,cb;cb=arr&&arr[i];++i){if(cb._id==fn._id){arr.splice(i,1);i--}}}else{callbacks[name]=[]}})}return el};el.one=function(name,fn){if(fn)fn.one=1;return el.on(name,fn)};el.trigger=function(name){var args=[].slice.call(arguments,1),fns=callbacks[name]||[];for(var i=0,fn;fn=fns[i];++i){if(!fn.busy){fn.busy=1;fn.apply(el,fn.typed?[name].concat(args):args);if(fn.one){fns.splice(i,1);i--}else if(fns[i]!==fn){i--}fn.busy=0}}return el};return el};(function(riot,evt){if(!this.top)return;var loc=location,fns=riot.observable(),win=window,current;function hash(){return loc.hash.slice(1)}function parser(path){return path.split("/")}function emit(path){if(path.type)path=hash();if(path!=current){fns.trigger.apply(null,["H"].concat(parser(path)));current=path}}var r=riot.route=function(arg){if(arg[0]){loc.hash=arg;emit(arg)}else{fns.on("H",arg)}};r.exec=function(fn){fn.apply(null,parser(hash()))};r.parser=function(fn){parser=fn};win.addEventListener?win.addEventListener(evt,emit,false):win.attachEvent("on"+evt,emit)})(riot,"hashchange");var brackets=function(orig,s,b){return function(x){s=riot.settings.brackets||orig;if(b!=s)b=s.split(" ");return x&&x.test?s==orig?x:RegExp(x.source.replace(/\{/g,b[0].replace(/(?=.)/g,"\\")).replace(/\}/g,b[1].replace(/(?=.)/g,"\\")),x.global?"g":""):b[x]}}("{ }");var tmpl=function(){var cache={},re_vars=/(['"\/]).*?[^\\]\1|\.\w*|\w*:|\b(?:(?:new|typeof|in|instanceof) |(?:this|true|false|null|undefined)\b|function *\()|([a-z_$]\w*)/gi;return function(str,data){return str&&(cache[str]=cache[str]||tmpl(str))(data)};function tmpl(s,p){s=(s||brackets(0)+brackets(1)).replace(brackets(/\\{/g),"￰").replace(brackets(/\\}/g),"￱");p=split(s,brackets(/{[\s\S]*?}/g));return new Function("d","return "+(!p[0]&&!p[2]&&!p[3]?expr(p[1]):"["+p.map(function(s,i){return i%2?expr(s,true):'"'+s.replace(/\n/g,"\\n").replace(/"/g,'\\"')+'"'}).join(",")+'].join("")').replace(/\uFFF0/g,brackets(0)).replace(/\uFFF1/g,brackets(1))+";")}function expr(s,n){s=s.replace(/\n/g," ").replace(brackets(/^[{ ]+|[ }]+$|\/\*.+?\*\//g),"");return/^\s*[\w- "']+ *:/.test(s)?"["+s.replace(/\W*([\w- ]+)\W*:([^,]+)/g,function(_,k,v){return v.replace(/[^&|=!><]+/g,wrap)+'?"'+k.trim()+'":"",'})+'].join(" ").trim()':wrap(s,n)}function wrap(s,nonull){s=s.trim();return!s?"":"(function(v){try{v="+(s.replace(re_vars,function(s,_,v){return v?"(d."+v+"===undefined?window."+v+":d."+v+")":s})||"x")+"}finally{return "+(nonull===true?'!v&&v!==0?"":v':"v")+"}}).call(d)"}function split(s,re){var parts=[],last=0;s.replace(re,function(m,i){parts.push(s.slice(last,i),m);last=i+m.length});return parts.concat(s.slice(last))}}();function loopKeys(expr){var ret={val:expr},els=expr.split(/\s+in\s+/);if(els[1]){ret.val=brackets(0)+els[1];els=els[0].slice(brackets(0).length).trim().split(/,\s*/);ret.key=els[0];ret.pos=els[1]}return ret}function mkitem(expr,key,val){var item={};item[expr.key]=key;if(expr.pos)item[expr.pos]=val;return item}function _each(dom,parent,expr){remAttr(dom,"each");var template=dom.outerHTML,prev=dom.previousSibling,root=dom.parentNode,rendered=[],tags=[],checksum;expr=loopKeys(expr);function add(pos,item,tag){rendered.splice(pos,0,item);tags.splice(pos,0,tag)}parent.one("update",function(){root.removeChild(dom)}).one("premount",function(){if(root.stub)root=parent.root}).on("update",function(){var items=tmpl(expr.val,parent);if(!items)return;if(!Array.isArray(items)){var testsum=JSON.stringify(items);if(testsum==checksum)return;checksum=testsum;each(tags,function(tag){tag.unmount()});rendered=[];tags=[];items=Object.keys(items).map(function(key){return mkitem(expr,key,items[key])})}each(arrDiff(rendered,items),function(item){var pos=rendered.indexOf(item),tag=tags[pos];if(tag){tag.unmount();rendered.splice(pos,1);tags.splice(pos,1)}});var nodes=root.childNodes,prev_index=[].indexOf.call(nodes,prev);each(items,function(item,i){var pos=items.indexOf(item,i),oldPos=rendered.indexOf(item,i);pos<0&&(pos=items.lastIndexOf(item,i));oldPos<0&&(oldPos=rendered.lastIndexOf(item,i));if(oldPos<0){if(!checksum&&expr.key)item=mkitem(expr,item,pos);var tag=new Tag({tmpl:template},{before:nodes[prev_index+1+pos],parent:parent,root:root,item:item});tag.mount();return add(pos,item,tag)}if(expr.pos&&tags[oldPos][expr.pos]!=pos){tags[oldPos].one("update",function(item){item[expr.pos]=pos});tags[oldPos].update()}if(pos!=oldPos){root.insertBefore(nodes[prev_index+oldPos+1],nodes[prev_index+pos+1]);return add(pos,rendered.splice(oldPos,1)[0],tags.splice(oldPos,1)[0])}});rendered=items.slice()})}function parseNamedElements(root,parent,child_tags){walk(root,function(dom){if(dom.nodeType==1){var child=getTag(dom);if(child&&!dom.getAttribute("each")){var tag=new Tag(child,{root:dom,parent:parent});parent.tags[dom.getAttribute("name")||child.name]=tag;child_tags.push(tag)}each(dom.attributes,function(attr){if(/^(name|id)$/.test(attr.name))parent[attr.value]=dom})}})}function parseExpressions(root,tag,expressions){function addExpr(dom,val,extra){if(val.indexOf(brackets(0))>=0){var expr={dom:dom,expr:val};expressions.push(extend(expr,extra))}}walk(root,function(dom){var type=dom.nodeType;if(type==3&&dom.parentNode.tagName!="STYLE")addExpr(dom,dom.nodeValue);if(type!=1)return;var attr=dom.getAttribute("each");if(attr){_each(dom,tag,attr);return false}each(dom.attributes,function(attr){var name=attr.name,bool=name.split("__")[1];addExpr(dom,attr.value,{attr:bool||name,bool:bool});if(bool){remAttr(dom,name);return false}});if(getTag(dom))return false})}function Tag(impl,conf){var self=riot.observable(this),opts=inherit(conf.opts)||{},dom=mkdom(impl.tmpl),parent=conf.parent,expressions=[],child_tags=[],root=conf.root,item=conf.item,fn=impl.fn,attr={},loop_dom;if(fn&&root.riot)return;root.riot=true;extend(this,{parent:parent,root:root,opts:opts,tags:{}},item);each(root.attributes,function(el){attr[el.name]=el.value});function updateOpts(rem_attr){each(Object.keys(attr),function(name){opts[name]=tmpl(attr[name],parent||self)})}this.update=function(data,init){extend(self,data,item);updateOpts();self.trigger("update",item);update(expressions,self,item);self.trigger("updated")};this.mount=function(){updateOpts();fn&&fn.call(self,opts);toggle(true);parseExpressions(dom,self,expressions);self.update();self.trigger("premount");if(fn){while(dom.firstChild)root.appendChild(dom.firstChild)}else{loop_dom=dom.firstChild;root.insertBefore(loop_dom,conf.before||null)}if(root.stub)self.root=root=parent.root;self.trigger("mount")};this.unmount=function(){var el=fn?root:loop_dom,p=el.parentNode;if(p){if(parent)p.removeChild(el);else while(root.firstChild)root.removeChild(root.firstChild);toggle();self.trigger("unmount");self.off("*");delete root.riot}};function toggle(is_mount){each(child_tags,function(child){child[is_mount?"mount":"unmount"]()});if(parent){var evt=is_mount?"on":"off";parent[evt]("update",self.update)[evt]("unmount",self.unmount)}}parseNamedElements(dom,this,child_tags)}function setEventHandler(name,handler,dom,tag,item){dom[name]=function(e){e=e||window.event;e.which=e.which||e.charCode||e.keyCode;e.target=e.target||e.srcElement;e.currentTarget=dom;e.item=item;if(handler.call(tag,e)!==true){e.preventDefault&&e.preventDefault();e.returnValue=false}var el=item?tag.parent:tag;el.update()}}function insertTo(root,node,before){if(root){root.insertBefore(before,node);root.removeChild(node)}}function update(expressions,tag,item){each(expressions,function(expr){var dom=expr.dom,attr_name=expr.attr,value=tmpl(expr.expr,tag),parent=expr.dom.parentNode;if(value==null)value="";if(parent&&parent.tagName=="TEXTAREA")value=value.replace(/riot-/g,"");if(expr.value===value)return;expr.value=value;if(!attr_name)return dom.nodeValue=value;remAttr(dom,attr_name);if(typeof value=="function"){setEventHandler(attr_name,value,dom,tag,item)}else if(attr_name=="if"){var stub=expr.stub;if(value){stub&&insertTo(stub.parentNode,stub,dom)}else{stub=expr.stub=stub||document.createTextNode("");insertTo(dom.parentNode,dom,stub)}}else if(/^(show|hide)$/.test(attr_name)){if(attr_name=="hide")value=!value;dom.style.display=value?"":"none"}else if(attr_name=="value"){dom.value=value}else if(attr_name.slice(0,5)=="riot-"){attr_name=attr_name.slice(5);value?dom.setAttribute(attr_name,value):remAttr(dom,attr_name)}else{if(expr.bool){dom[attr_name]=value;if(!value)return;value=attr_name}if(typeof value!="object")dom.setAttribute(attr_name,value)}})}function each(els,fn){for(var i=0,len=(els||[]).length,el;i<len;i++){el=els[i];if(el!=null&&fn(el,i)===false)i--}return els}function remAttr(dom,name){dom.removeAttribute(name)}function extend(obj,from,from2){from&&each(Object.keys(from),function(key){obj[key]=from[key]});return from2?extend(obj,from2):obj}function mkdom(template){var tag_name=template.trim().slice(1,3).toLowerCase(),root_tag=/td|th/.test(tag_name)?"tr":tag_name=="tr"?"tbody":"div",el=document.createElement(root_tag);el.stub=true;el.innerHTML=template;return el}function walk(dom,fn){if(dom){if(fn(dom)===false)walk(dom.nextSibling,fn);else{dom=dom.firstChild;while(dom){walk(dom,fn);dom=dom.nextSibling}}}}function arrDiff(arr1,arr2){return arr1.filter(function(el){return arr2.indexOf(el)<0})}function inherit(parent){function Child(){}Child.prototype=parent;return new Child}var virtual_dom=[],tag_impl={};function getTag(dom){return tag_impl[dom.tagName.toLowerCase()]}function injectStyle(css){var node=document.createElement("style");node.innerHTML=css;document.head.appendChild(node)}function mountTo(root,tagName,opts){var tag=tag_impl[tagName];if(tag&&root)tag=new Tag(tag,{root:root,opts:opts});if(tag&&tag.mount){tag.mount();virtual_dom.push(tag);return tag.on("unmount",function(){virtual_dom.splice(virtual_dom.indexOf(tag),1)})}}riot.tag=function(name,html,css,fn){if(typeof css=="function")fn=css;else if(css)injectStyle(css);tag_impl[name]={name:name,tmpl:html,fn:fn}};riot.mount=function(selector,tagName,opts){if(selector=="*")selector=Object.keys(tag_impl).join(", ");if(typeof tagName=="object"){opts=tagName;tagName=0}var tags=[];function push(root){var name=tagName||root.tagName.toLowerCase(),tag=mountTo(root,name,opts);if(tag)tags.push(tag)}if(selector.tagName){push(selector);return tags[0]}else{each(document.querySelectorAll(selector),push);return tags}};riot.update=function(){return each(virtual_dom,function(tag){tag.update()})};riot.mountTo=riot.mount;riot.util={brackets:brackets,tmpl:tmpl};if(typeof exports==="object")module.exports=riot;else if(typeof define==="function"&&define.amd)define(function(){return riot});else this.riot=riot})()},{}],65:[function(require,module,exports){var _={defaults:require("lodash/object/defaults"),merge:require("lodash/object/merge"),pick:require("lodash/object/pick"),reject:require("lodash/collection/reject")};var fbref=new Firebase("https://musifavs.firebaseio.com"),timeago=require("../lib/fromnow"),yt=require("../lib/youtube");function Post(opts,key){this.setattr(_.defaults({},opts,{key:key},Post.defaults))}Post.defaults={date:undefined,desc:"",embed:{},favers:{},key:null,stored:false,title:"",uid:undefined,userName:undefined};Post.prototype.equals=function(other){return this.key===other.key};Post.prototype.toString=function(){return JSON.stringify(_.pick(this.getattr(),["title","key"]))};Post.prototype.getattr=function(){return _.pick(this,Object.keys(Post.defaults))};Post.prototype.setattr=function(opts){_.merge(this,opts);var p=this;this.stored=!!p.key&&p.key!="new";this.date=p.date?new Date(p.date):new Date;if(p.embed&&(!p.embed.type||p.embed.type=="unknown")){this.embed=yt.extractEmbed(p.embed.url)}return this};Post.prototype.validation=function(){var p=this,r={errors:[],isValid:true};if(!p.date instanceof Date){r.errors.date="date is invalid";r.isValid=false}if(!p.title||p.title.length===0){r.errors.title="title can't be blank";r.isValid=false}if(!p.embed||!p.embed.type||p.embed.type=="unknown"){r.errors.url="the embed url is invalid";r.isValid=false}return r};Post.prototype.timeago=function(){return timeago(this.date)};Post.prototype.favoritedBy=function(uid){return!!this.favers[uid]};Post.prototype.fbrootref=function(){return fbref.child("user_posts/"+this.uid)};Post.prototype.fbpostref=function(postfix){return this.fbrootref().child("/"+this.key+(postfix?"/"+postfix:""))};require("riot").observable(Post);Post.destroy=function(post){post.fbpostref().remove(function(error){if(!error){post.destroyed=true;Post.trigger("store:posts:did:destroy",post)}})};var listeners={};Post.retrieve=function retrieve(collection){if(listeners[collection]){return}var ref=fbref.child(collection).orderByPriority();listeners[collection]=ref.on("child_added",function(snapshot){var post=new Post(snapshot.val(),snapshot.key());Post.trigger("store:posts:did:retrieve",collection,post)})};Post.stopRetrieve=function(collection){if(!listeners[collection]){return}fbref.off("child_added",listeners[collection]);delete listeners[collection]};Post.latest=function(collection){var r=fbref.child(collection).orderByPriority().limitToFirst(10);r.once("value",function(snapshot){var data=snapshot.val();if(!data){return}var latest=Object.keys(data).reduce(function(acc,key){acc.push(new Post(data[key],key));return acc},[]).sort(function(post1,post2){return post2.date-post1.date});Post.trigger("store:posts:did:latest",collection,latest)})};Post.persist=function persist(post){var date=new Date;var attrs=_.merge(post.getattr(),{date:date.valueOf(),uid:post.uid});var r=post.fbrootref().push(attrs,function(error){if(error){Post.trigger("store:posts:failed:persist",post,error)}else{post.setattr({key:r.key(),date:date});Post.trigger("store:posts:did:persist",post);r.setPriority(date.valueOf())}})};Post.update=function update(post){post.fbpostref().update(post.getattr(),function(error){if(error){Post.trigger("store:posts:failed:update",post,error)}else{Post.trigger("store:posts:did:update",post)}})};Post.toggleFav=function(post,uid){var favers=_.merge({},post.favers);if(post.favoritedBy(uid)){delete favers[uid]}else{favers[uid]=true}post.fbpostref("favers").update(favers,function(error){if(error){Post.trigger("store:posts:failed:togglefav",post,error)}else{post.favers=favers;var upstref=fbref.child("user_posts/"+post.uid+"/"+post.key),ufavref=fbref.child("user_favorites/"+post.uid+"/"+post.key);upstref.update(post.getattr());if(post.favoritedBy(post.uid)){ufavref.update(post.getattr())}else{ufavref.remove()}var favsref=fbref.child("favorited/"+post.key);if(Object.keys(post.favers).length>0){favsref.update(post.getattr())}else{favsref.remove()}otherUids=_.reject(Object.keys(favers).concat(uid),function(_uid){return _uid==post.uid});otherUids.forEach(function(uid){var otherfav=fbref.child("user_favorites/"+uid+"/"+post.key);if(post.favoritedBy(uid)){otherfav.update(post.getattr())}else{otherfav.remove()}});Post.trigger("store:posts:did:togglefav",post,uid)}})};function updatePostReferences(post){var f=fbref,usf,pst="posts/"+post.key,fav="favorited/"+post.key,atr=_.merge(post.getattr(),{date:post.date.valueOf()});favUids=Object.keys(post.favers);if(post.destroyed){f.child(fav).remove();f.child(pst).remove();favUids.forEach(function(uid){f.child("user_favorites/"+uid+"/"+post.key).remove()})}else{f.child(pst).set(atr)}}Post.on("store:posts:did:persist",updatePostReferences);Post.on("store:posts:did:update",updatePostReferences);Post.on("store:posts:did:destroy",updatePostReferences);Post.on("store:posts:did:togglefav",updatePostReferences);module.exports=Post},{"../lib/fromnow":68,"../lib/youtube":69,"lodash/collection/reject":3,"lodash/object/defaults":55,"lodash/object/merge":58,"lodash/object/pick":59,riot:64}],66:[function(require,module,exports){var _={defaults:require("lodash/object/defaults"),pick:require("lodash/object/pick")};var fbref=new Firebase("https://musifavs.firebaseio.com");function User(opts,uid){_.defaults(this,opts,User.defaults);if(User.current&&User.current.uid===uid){_.defaults(this,User.current)}}User.defaults={avatarUrl:"/assets/profile.png",description:"MusiFavs! user",displayName:"user",location:"Universe",logged:false,provider:"unknown",url:"https://musifavs.com"};User.prototype.getattr=function(){return _.pick(this,Object.keys(User.defaults))};User.prototype.logout=function(){this.authData=null;this.logged=false;this.provider="unknown";this.uid=null};User.prototype.update=function(){var user=this;if(!user.uid){return}fbref.child("users"+"/"+user.uid).set(user.getattr(),function(error){if(error){User.trigger("store:users:failed:update",user)}else{User.trigger("store:users:did:update",user)}})};User.prototype.toString=function(){return JSON.stringify(_.pick(this.getattr(),["displayName","logged"]))};require("riot").observable(User);function updateAuth(authData){if(!authData){return}var p,u=User.current;u.uid=authData.uid;u.authData=authData;u.provider=authData.provider;u.logged=true;if(authData.provider=="twitter"){u.displayName=authData.twitter.displayName;p=authData.twitter.cachedUserProfile;if(p){u.description=p.description;u.location=p.location;u.url=p.url}}else if(authData.provider=="google"){u.displayName=authData.google.displayName;p=authData.google.cachedUserProfile;if(p){u.avatarUrl=p.picture;u.description="G+ User";u.location="Planet Earth";u.url=p.link}}_.defaults(this,u.defaults);u.update()}User.login=function(provider){fbref.authWithOAuthPopup(provider,function(error,authData){if(error||!authData){User.trigger("store:users:failed:login",error||{code:"unknown"})}else{updateAuth(authData)}})};User.logout=function(){if(User.current&&User.current.logged){User.current.logout();fbref.unauth()}};User.lookup=function(uid){fbref.child("users").child(uid).once("value",function(snapshot){var data=snapshot.val();if(data){User.trigger("store:users:did:lookup",uid,new User(data,uid))}else{User.trigger("store:users:failed:lookup",uid)}})};User.setupCurrent=function(){User.current=new User;fbref.onAuth(function(authData){if(authData){updateAuth(authData);User.trigger("store:users:did:login",User.current,authData)}else{User.current.logout();User.trigger("store:users:did:logout",User.current)}})};module.exports=User},{"lodash/object/defaults":55,"lodash/object/pick":59,riot:64}],67:[function(require,module,exports){var _={isFunction:require("lodash/lang/isFunction")};function DomWrap(node,selector){this[0]=this.node=node;this.id=node.id;if(selector){this.node=node.querySelector(selector)}this.listeners=[]}DomWrap.prototype.select=function(selector){return new DomWrap(this.node.querySelector(selector))};DomWrap.prototype.html=function(html){this.node.innerHTML=html;return this};DomWrap.prototype.prepend=function(node){this.node.insertBefore(node,this.node.firstChild);return this};DomWrap.prototype.append=function(node){this.node.appendChild(node);return this};DomWrap.prototype.remove=function(node){this.node.removeChild(node);return this};DomWrap.prototype.text=function(text){this.node.textContent=text;return this};DomWrap.prototype.val=function(){if(arguments.length){this.node.value=arguments[0]}return this.node.value};DomWrap.prototype.addClass=function(classname){this.node.classList.add(classname);return this};DomWrap.prototype.removeClass=function(classname){this.node.classList.remove(classname);return this};DomWrap.prototype.parent=function(selector){var t=this.node.parentElement;while(t){if(t.matches(selector)){return new DomWrap(t)}t=t.parentElement}};DomWrap.prototype.matches=function(selector){return this.node.matches(selector)};DomWrap.prototype.data=function(name){return this.node.getAttribute("data-"+name)};DomWrap.prototype.on=function(eventname,selector,callback){var fn,n=this.node;if(_.isFunction(selector)){callback=selector;fn=function(ev){ev.preventDefault();callback(new DomWrap(ev.target),ev)}}else{fn=function(ev){var n=new DomWrap(ev.target),r=n.matches(selector)?n:n.parent(selector);if(r){ev.preventDefault();callback(r,ev)}}}n.addEventListener(eventname,fn);this.listeners.push({eventname:eventname,fn:fn});return this};DomWrap.prototype.off=function(eventname,callback){if(arguments.length){this.node.removeEventListener(eventname,callback)}else{this.listeners.forEach(function(data){this.node.removeEventListener(data.eventname,data.fn)},this);this.listeners=[]}return this};module.exports=function(node,selector){return new DomWrap(node,selector)}},{"lodash/lang/isFunction":48}],68:[function(require,module,exports){module.exports=function(date){var between=(Date.now()-date)/1e3;if(between<0){return"recently"}if(between<3600){return~~(between/60)+" minutes ago"}else if(between<86400){return~~(between/3600)+" hours ago"}return~~(between/86400)+" days ago"}},{}],69:[function(require,module,exports){var urlregex=/youtube.com.+\?v=([a-zA-z0-9\-_]+)/i;exports.extractEmbed=function(url){var match=urlregex.exec(url);if(match&&match.length){return{type:"youtube",url:url,videoId:match[1]}}else{return{type:"unknown",url:url}}}},{}],70:[function(require,module,exports){require("./app/user").setupCurrent();var Message=require("./modules/message/message"),Navigation=require("./modules/navigation/navigation"),Main=require("./modules/main/main");var main=new Main(document.querySelector("#app-main")),msg=new Message(main,document.querySelector("#app-message")),nav=new Navigation(main,document.querySelector("#app-navigation"));var riot=require("riot");var router=main.router.bind(main);riot.route(router);riot.route.exec(router)},{"./app/user":66,"./modules/main/main":76,"./modules/message/message":78,"./modules/navigation/navigation":80,riot:64}],71:[function(require,module,exports){var _={escape:require("lodash.escape")};module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<main class="main app-front" role="main"><img class="responsive-width" src="/assets/music.jpg"><div class="front-copy"><h1>A micro Blog for your favorite Music!</h1><p>Share your favorite music and videos with your friends.<br>With MusiFavs you can embed content from YouTube, SoundCloud, and more, in a single place!</p><h2>Latest Posts</h2><ul class="post-list latest-posts"></ul><h2>Latest Favorited</h2><ul class="post-list latest-favs"></ul></div></main>'}return __p}},{"lodash.escape":1}],72:[function(require,module,exports){var $=require("../../lib/domWrap"),Post=require("../../app/post"),itemstpl=require("./post-items.html"),template=require("./front.html");function Front(parent,node,options){this.parent=parent;var f=this,r=$(node).html(template(options));this.nodes={root:r,posts:r.select(".latest-posts"),favorited:r.select(".latest-favs")};f.handlePosts=function(collection,posts){f.nodes[collection].html(itemstpl({posts:posts}))};Post.on("store:posts:did:latest",f.handlePosts);Post.latest("posts");Post.latest("favorited")}Front.prototype.unload=function(){this.nodes.root.html("");Post.off("store:posts:did:latest",this.handlePosts)};module.exports=Front},{"../../app/post":65,"../../lib/domWrap":67,"./front.html":71,"./post-items.html":73}],73:[function(require,module,exports){var _={escape:require("lodash.escape")};module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="";posts.forEach(function(post){__p+='<li><i class="fa fa-play"></i>&nbsp;'+((__t=post.title)==null?"":__t)+' posted by&nbsp; <a href="#'+((__t=post.uid)==null?"":__t)+'/posts">'+((__t=post.userName)==null?"":__t)+'&nbsp;<i class="fa fa-child"></i></a> &nbsp; <span class="timeago">('+((__t=post.timeago())==null?"":__t)+")</span></li>"});__p+=""}return __p}},{"lodash.escape":1}],74:[function(require,module,exports){var _={escape:require("lodash.escape")};module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<main class="main app-login" role="main"><div class="filler"></div><div class="front-copy"><h1>Log In</h1><p>In order to interact with MusiFavs! you\'ll need to log in first.</p><p>Please select one of the services below to log in:</p><ul class="login-links fa-ul fa-2x"><li><i class="fa-li fa fa-google-plus-square"></i> <a href="#" id="google-login">Google</a></li><li><i class="fa-li fa fa-twitter-square"></i> <a href="#" id="twitter-login">Twitter</a></li></ul></div></main>'}return __p}},{"lodash.escape":1}],75:[function(require,module,exports){var $=require("../../lib/domWrap"),User=require("../../app/user"),template=require("./login.html");function Login(parent,node,options){this.parent=parent;var l=this,r=$(node).html(template(options));l.nodes={root:r,list:r.select(".login-links")};l.loginListener=function(target){if(target.id=="twitter-login"){User.login("twitter")}else if(target.id=="google-login"){User.login("google")}else{l.parent.message("Sorry, authenticating with this provider is not available yet.")}};l.nodes.list.on("click",l.loginListener)}Login.prototype.unload=function(){this.nodes.list.off("click",this.loginListener);this.nodes.root.html("")};module.exports=Login},{"../../app/user":66,"../../lib/domWrap":67,"./login.html":74}],76:[function(require,module,exports){var User=require("../../app/user"),riot=require("riot");require("../front/front");require("../login/login");require("../user/user");function Main(rootNode){riot.observable(this);var m=this;m.rootNode=rootNode;m.on("module:user:failed:lookup",function(){window.location.hash="";m.message("Sorry, we could not find that user.")});m.on("module:navigation:did:newpost",function(user){if(window.location.hash!="#me/posts"){window.location.hash="me/posts";m.showNewPost=true}else{m.lastmod.showNewPost()}});m.on("module:user:did:lookup",function(uid,user){if(m.showNewPost){m.lastmod.showNewPost();m.showNewPost=false}});User.on("store:users:did:login",function(user){user.update();window.location.hash="";m.message("Thank you! You have been logged in.")});User.on("store:users:did:logout",function(){window.location.hash="";m.message("You've been logged out.")})}Main.prototype.message=function(text){this.trigger("module:message:do:message",text)};Main.prototype.loadmod=function(name,options){var m=this,Ctor=require("../"+name+"/"+name);if(m.lastmod){m.lastmod.unload()}m.lastmod=new Ctor(m,m.rootNode,options)};Main.prototype.router=function(_uid,action,postid){this.trigger("module:main:did:router");var m=this,user=User.current;var uid=_uid=="me"?user.uid:_uid;switch(action){case"posts":case"favorites":if(_uid=="me"&&!user.logged){m.loadmod("login");m.message("Please login to access your posts.")}else{m.loadmod("user",{uid:uid,action:action})}break;case"logout":if(user.logged){user.logout()}window.location.hash="";break;default:m.loadmod("front")}};module.exports=Main},{"../../app/user":66,"../front/front":72,"../login/login":75,"../user/user":87,riot:64}],77:[function(require,module,exports){var _={escape:require("lodash.escape")};module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<span class="app-message-text"></span><div class="app-message-dismiss"><a href="#" class="app-message-dismiss">Dismiss</a></div>'}return __p}},{"lodash.escape":1}],78:[function(require,module,exports){var $=require("../../lib/domWrap"),template=require("./message.html");function Message(parent,node,options){this.parent=parent;var m=this,r=$(node).html(template(options));m.nodes={root:r,text:r.select(".app-message-text"),dism:r.select(".app-message-dismiss")};m.mainDoMessageListener=function(text){m.show(text)}.bind(this);m.parent.on("module:message:do:message",m.mainDoMessageListener);m.nodes.dism.on("click",function(target){m.dismiss()})}Message.prototype.unload=function(){this.parent.off("module:main:do:message",this.mainDoMessageListener);this.nodes.dism.off();this.nodes.root.html("")};Message.prototype.show=function(message){this.nodes.root.removeClass("app-hidden");this.nodes.text.text(message)};Message.prototype.dismiss=function(){this.nodes.root.addClass("app-hidden");this.nodes.text.text("")};module.exports=Message},{"../../lib/domWrap":67,"./message.html":77}],79:[function(require,module,exports){var _={escape:require("lodash.escape")};module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<nav class="navigation"><ul class="nav-actions" role="navigation"><li><a id="nav-newpost" href="#">New Post</a></li><li><a href="#me/posts">My Posts</a></li><li><a href="#me/favorites">My Favorites</a></li><li><a id="nav-logout" href="#me/logout">Log Out</a></li></ul></nav>'}return __p}},{"lodash.escape":1}],80:[function(require,module,exports){var $=require("../../lib/domWrap"),User=require("../../app/user"),riot=require("riot"),template=require("./navigation.html");function Navigation(parent,node,options){this.parent=parent;var n=this,r=$(node).html(template(options));n.nodes={root:r,logout:r.select("#nav-logout"),newpost:r.select("#nav-newpost")};n.updateLogout=function(){if(User.current.logged){n.showLogout()}else{n.hideLogout()}};n.newpostListener=function(target){n.parent.trigger("module:navigation:did:newpost")};n.parent.on("module:main:did:router",n.updateLogout);n.nodes.newpost.on("click",n.newpostListener)}Navigation.prototype.unload=function(){var n=this;n.parent.off("module:main:did:router",n.updateLogout);n.nodes.newpost.on("click",n.newpostListener);n.nodes.root.html("")};Navigation.prototype.showLogout=function(){this.nodes.logout.removeClass("app-hidden")};Navigation.prototype.hideLogout=function(){this.nodes.logout.addClass("app-hidden")};module.exports=Navigation},{"../../app/user":66,"../../lib/domWrap":67,"./navigation.html":79,riot:64}],81:[function(require,module,exports){var _={escape:require("lodash.escape")};module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="<h2>"+((__t=stored?"Editing Post":"New Post")==null?"":__t)+'</h2><p>Please provide the resource url to share, a title and a description.</p><div class="post-form-embed"><label>Embed Url (e.g. YouTube Url)</label><input name="url" type="url" placeholder="https://www.youtube.com/watch?v=P9J5tYShNY8"></div><div class="post-form-data"><input name="title" title="Post Title" type="text" placeholder="Title"><textarea title="Post Description" placeholder="Description"></textarea></div><div class="post-actions" data-post-key="'+((__t=postKey)==null?"":__t)+'"><a class="undo" title="Undo" href="#"><i class="fa fa-times-circle"></i>&nbsp;Cancel</a> <a class="save" title="Save and Publish" href="#"><i class="fa fa-save"></i>&nbsp;Save</a> <span class="post-edit-message"></span></div>'
}return __p}},{"lodash.escape":1}],82:[function(require,module,exports){var _={merge:require("lodash/object/merge"),values:require("lodash/object/values")};var $=require("../../lib/domWrap"),Post=require("../../app/post"),template=require("./form.html");function PostForm(parent,node,options){this.parent=parent;this.post=new Post(options.post);var attr=_.merge({postKey:this.post.key||"new"},this.post),r=$(node).html(template(attr)).addClass("app-post-form");this.nodes={root:r,formMessage:r.select(".post-edit-message"),inputTitle:r.select("input[name=title]"),inputUrl:r.select("input[name=url]"),inputDesc:r.select("textarea")};this.updateForm()}PostForm.prototype.unload=function(){this.nodes.root.removeClass("app-post-form").html("")};PostForm.prototype.updateForm=function(){var n=this.nodes,p=this.post;n.inputTitle.val(p.title);n.inputUrl.val(p.embed.url||"");n.inputDesc.val(p.desc)};PostForm.prototype.updatePost=function(){var n=this.nodes;this.post.setattr({title:n.inputTitle.val(),embed:{url:n.inputUrl.val()},desc:n.inputDesc.val()})};PostForm.prototype.isValid=function(){var result=this.post.validation(),n=this.nodes;n.inputUrl.removeClass("invalid");n.inputTitle.removeClass("invalid");if(result.isValid){return true}else{if(result.errors.url){n.inputUrl.addClass("invalid")}if(result.errors.title){n.inputTitle.addClass("invalid")}var msg=_.values(result.errors).join(", ");n.formMessage.text("Sorry, the post can't be saved: "+msg+".");return false}};module.exports=PostForm},{"../../app/post":65,"../../lib/domWrap":67,"./form.html":81,"lodash/object/merge":58,"lodash/object/values":60}],83:[function(require,module,exports){var _={escape:require("lodash.escape")};module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<p class="timeago">posted by&nbsp;'+((__t=userName)==null?"":__t)+"&nbsp;"+((__t=timeago)==null?"":__t)+'</p><h2><i class="fa fa-play"></i>&nbsp;'+((__t=title)==null?"":__t)+'</h2><div class="post-show-embed"><iframe type="text/html" width="640" height="260" src="https://www.youtube.com/embed/'+((__t=embed.videoId)==null?"":__t)+'" frameborder="0"></iframe></div><p class="post-show-description"><i class="fa fa-child fa-2x"></i>&nbsp;'+((__t=desc)==null?"":__t)+'</p><div class="post-actions" data-post-key="'+((__t=postKey)==null?"":__t)+'"><a class="fav" title="Favorite" href="#"><i class="fa fa-heart"></i>&nbsp;Favorite</a>';if(owned){__p+=' <a class="edit" title="Edit" href="#"><i class="fa fa-edit"></i>&nbsp;Edit</a> <a class="remove" title="Remove" href="#"><i class="fa fa-trash"></i>&nbsp;Remove</a>'}__p+="</div>"}return __p}},{"lodash.escape":1}],84:[function(require,module,exports){var $=require("../../lib/domWrap"),template=require("./show.html"),User=require("../../app/user");var _={merge:require("lodash/object/merge")};function PostShow(parent,node,options){this.parent=parent;var p=this.post=options.post,attr=_.merge(p.getattr(),{postKey:p.key||"new",timeago:p.timeago(),owned:p.uid==User.current.uid});var r=$(node).addClass("app-post-show").html(template(attr));this.nodes={root:r,fav:r.select(".fav")};this.updateFav()}PostShow.prototype.updateFav=function(){var p=this.post,f=this.nodes.fav;if(p.favoritedBy(User.current.uid)){f.addClass("post-favorited")}else{f.removeClass("post-favorited")}};PostShow.prototype.unload=function(){this.nodes.root.removeClass("app-post-show").html("")};module.exports=PostShow},{"../../app/user":66,"../../lib/domWrap":67,"./show.html":83,"lodash/object/merge":58}],85:[function(require,module,exports){var _={escape:require("lodash.escape")};module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<div class="profile-info"><ul class="fa-ul"><li><i class="fa-li fa fa-user"></i>'+((__t=user.displayName)==null?"":__t)+'</li><li><i class="fa-li fa fa-asterisk"></i>'+((__t=user.description)==null?"":__t)+'</li><li><i class="fa-li fa fa-map-marker"></i>'+((__t=user.location)==null?"":__t)+"</li>";if(user.provider=="twitter"){__p+='<li><i class="fa-li fa fa-twitter-square"></i> <a href="https://twitter.com/'+((__t=user.displayName)==null?"":__t)+'">@'+((__t=user.displayName)==null?"":__t)+"</a></li>"}__p+="";if(user.provider=="google"){__p+='<li><i class="fa-li fa fa-google-plus"></i> <a href="'+((__t=user.url)==null?"":__t)+'">'+((__t=user.displayName)==null?"":__t)+"</a><br></li>"}__p+='<li><i class="fa-li fa fa-asterisk"></i> <a title="See user favorites" href="#'+((__t=uid)==null?"":__t)+'/favorites">User Favs</a><br></li></ul></div>'}return __p}},{"lodash.escape":1}],86:[function(require,module,exports){var _={escape:require("lodash.escape")};module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<aside class="profile"></aside><main class="main" role="main"><div class="app-new-post"></div><div class="app-post-placeholder"><h1>Hey!&nbsp;<i class="fa fa-child"></i>&nbsp;<i class="fa fa-play"></i></h1><p>This user has not'+((__t=action=="posts"?" posted anything ":" favorited any post ")==null?"":__t)+'yet. Please check back later!</p></div><div class="app-posts"></div></main>'}return __p}},{"lodash.escape":1}],87:[function(require,module,exports){var $=require("../../lib/domWrap"),Post=require("../../app/post"),User=require("../../app/user"),PostForm=require("../post/form"),PostShow=require("../post/show"),proftpl=require("./profile.html"),template=require("./user.html");function UserMod(parent,node,options){this.parent=parent;var u=this;u.mods={};u.action=options.action;u.uid=options.uid;u.firebasepath="user_"+u.action+"/"+u.uid;var r=$(node).html(template(u));u.nodes={root:r,newpost:r.select(".app-new-post"),placehold:r.select(".app-post-placeholder"),posts:r.select(".app-posts"),prof:r.select(".profile")};u.userDidLookup=function(uid,user){u.user=user;u.redrawProfile();Post.retrieve(u.firebasepath);u.parent.trigger("module:user:did:lookup",uid,user)};u.userFailedLookup=function(uid){u.parent.trigger("module:user:failed:lookup",uid)};u.postsDidRetrieve=function(firebasepath,post){var m=u.mods[post.key];if(m){u.showmod(m)}else{u.addPost(post)}};u.postsDidUpdate=function(post){var m=u.mods[post.key];if(m){u.showmod(m)}};var actionMod=function(target){var key=target.parent(".post-actions").data("post-key");return u.mods[key]};r.on("click",".fav",function(target){var mod=actionMod(target);Post.toggleFav(mod.post,User.current.uid)});r.on("click",".edit",function(target){u.editPost(actionMod(target))});r.on("click",".remove",function(target){u.removePost(actionMod(target))});r.on("click",".undo",function(target){var mod=actionMod(target);if(mod.post.stored){u.showmod(mod)}else{u.hideNewPost()}});r.on("click",".save",function(target){var mod=actionMod(target);mod.updatePost();if(!mod.isValid()){}else if(mod.post.stored){Post.update(mod.post)}else{Post.persist(mod.post);u.hideNewPost()}});User.on("store:users:failed:lookup",u.userFailedLookup);User.on("store:users:did:lookup",u.userDidLookup);Post.on("store:posts:did:retrieve",u.postsDidRetrieve);Post.on("store:posts:did:update",u.postsDidUpdate);Post.on("store:posts:did:togglefav",u.postsDidUpdate);User.lookup(u.uid)}UserMod.prototype.unload=function(){var u=this;u.nodes.root.off().html("");User.off("store:users:failed:lookup",u.userFailedLookup);User.off("store:users:did:lookup",u.userDidLookup);Post.off("store:posts:did:retrieve",u.postsDidRetrieve);Post.off("store:posts:did:update",u.postsDidUpdate);Post.off("store:posts:did:togglefav",u.postsDidUpdate);Post.stopRetrieve(u.firebasepath)};UserMod.prototype.updatePlaceholder=function(){var modkeys=Object.keys(this.mods),p=this.nodes.placehold;if(modkeys.length>0||this.mods["new"]){p.addClass("app-hidden")}else{p.removeClass("app-hidden")}};UserMod.prototype.redrawProfile=function(){this.nodes.prof.html(proftpl(this))};UserMod.prototype.hideNewPost=function(){var u=this,m=u.mods.new,n=u.nodes.newpost;if(m){m.unload();n.html("");delete u.mods["new"]}u.updatePlaceholder()};UserMod.prototype.showNewPost=function(){var u=this,el,post;if(!u.mods.new){el=document.createElement("div");post=new Post({uid:u.uid,userName:u.user.displayName});u.mods["new"]=new PostForm(u,el,{post:post});u.nodes.newpost.append(el)}u.updatePlaceholder()};UserMod.prototype.editPost=function(mod){var u=this,el=mod.nodes.root[0];mod.unload();u.mods[mod.post.key]=new PostForm(u,el,{post:mod.post})};UserMod.prototype.addPost=function(post){var u=this,el=document.createElement("div"),pmod=new PostShow(u,el,{post:post});u.mods[post.key]=pmod;u.nodes.posts.prepend(pmod.nodes.root[0]);u.updatePlaceholder()};UserMod.prototype.showmod=function(mod){var u=this;if(mod instanceof PostForm){mod.unload();var pmod=new PostShow(u,mod.nodes.root[0],{post:mod.post});u.mods[mod.post.key]=pmod}else{mod.updateFav()}};UserMod.prototype.removePost=function(mod){var u=this;mod.unload();Post.destroy(mod.post);u.nodes.posts.remove(mod.nodes.root[0]);delete u.mods[mod.post.key];u.updatePlaceholder()};module.exports=UserMod},{"../../app/post":65,"../../app/user":66,"../../lib/domWrap":67,"../post/form":82,"../post/show":84,"./profile.html":85,"./user.html":86}]},{},[70]);