<app-user>
  <div class='flex-content-wrapper'>
    <aside class='profile'>
      <div class='profile-info'>
        <ul class='fa-ul'>
          <li class='profile-pic'>
            <img src={user.avatarUrl} />
          </li>
          <li>
            <i class='fa-li fa fa-link'></i>
            <a href="{user.url}">{user.displayName}</a><br>
          </li>

          <li>
            <i class='fa-li fa fa-user'></i>
            {user.description}
          </li>

          <li>
            <i class='fa-li fa fa-map-marker'></i>
            {user.location}
          </li>

          <li>
            <i class='fa-li fa fa-twitter-square'></i>
            <a href="https://twitter.com/{user.displayName}">@{user.displayName}</a>
          </li>
        </ul>
      </div>
    </aside>

    <main class='main' role='main'>
      <app-post if={newPost} post={newPost}></app-post>

      <div if={!newPost && posts.length === 0} class='post-placeholder'>
        <h1>Hey!&nbsp;<i class='fa fa-child'></i>&nbsp;<i class='fa fa-play'></i></h1>
        <p>
          This user has not posted anything yet. Please check back later!
        </p>
      </div>

      <app-post each={post, i in posts} post={post}></app-post>
    </main>
  </div>

  <script>
    var Dispatcher = require('../app/dispatcher')
    var Post = require('../app/post')
    var Users = require('../app/users')

    this.user = Users.current
    this.posts = []
    this.userPosts = {}

    Dispatcher.on('posts:child_added', function(uid, post){
      if (!this.userPosts[uid]) {
        this.userPosts[uid] = []
      }
      this.userPosts[uid].unshift(post)
      this.update({posts: this.userPosts[uid]})
    }.bind(this))

    Dispatcher.on('posts:removed', function(uid, key) {
      var reject = require('lodash/collection/reject')
      var posts = this.userPosts[uid]

      if (posts) {
        posts = reject(posts, function(post){ return post.key == key })
      }

      this.userPosts[uid] = posts
      this.update({posts: this.userPosts[uid]})
    }.bind(this))

    Dispatcher.on('user:posts', function(uid) {
      Dispatcher.trigger('posts:user:load', uid)
    }.bind(this))

    Dispatcher.on('user:newpost', function(user) {
      this.update({newPost: new Post()})
    }.bind(this))

    Dispatcher.on('user:cancelcreatepost', function() {
      this.update({newPost: null})
    }.bind(this))
  </script>
</app-user>
