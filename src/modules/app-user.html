<app-user>
  <div class='flex-content-wrapper'>

    <aside class='profile'>
      <div class='profile-info'>
        <ul class='fa-ul'>
          <li class='profile-pic'>
            <img src={user.avatarUrl} />
          </li>
          <li>
            <i class='fa-li fa fa-link'></i>
            <a href="{user.url}">{user.displayName}</a><br>
          </li>

          <li>
            <i class='fa-li fa fa-user'></i>
            {user.description}
          </li>

          <li>
            <i class='fa-li fa fa-map-marker'></i>
            {user.location}
          </li>

          <li>
            <i class='fa-li fa fa-twitter-square'></i>
            <a href="https://twitter.com/{user.displayName}">@{user.displayName}</a>
          </li>

          <li>
            Displaying {this.posts.length} Posts
          </li>
        </ul>
      </div>
    </aside>

    <main class='main' role='main'>
      <app-post if={newPost} post={newPost} on={on} tr={tr}></app-post>

      <div if={!newPost && posts.length === 0} class='post-placeholder'>
        <h1>Hey!&nbsp;<i class='fa fa-child'></i>&nbsp;<i class='fa fa-play'></i></h1>
        <p>
          This user has not posted anything yet. Please check back later!
        </p>
      </div>

      <app-post class='app-post' each={post, i in posts} post={post} don={don} dtr={dtr}></app-post>
    </main>
  </div>

  <script>
    this.don = opts.don
    this.dtr = opts.dtr
    this.posts = []
    this.newPost = null

    this.dtr('store:users:do:lookup', opts.uid)

    this.don('store:users:failed:lookup', function(uid) {
      this.dtr('module:user:failed:mount', uid)
    })

    this.don('store:users:did:lookup', function(uid, user) {
      this.dtr('store:posts:do:retrieve', uid)
      this.update({user: user})
    }.bind(this))

    this.don('store:posts:did:retrieve', function(post){
      this.posts.unshift(post)
      this.update()
    }.bind(this))

    this.don('store:posts:did:destroy', function(post) {
      var reject = require('lodash/collection/reject')
      var posts = reject(posts, function(post){ return post.key == key })
      this.update({posts: posts})
    }.bind(this))

    this.don('user:newpost', function(user) {
      this.update({newPost: new Post()})
    }.bind(this))

    this.don('module:user:do:cancelcreatepost', function() {
      this.update({newPost: null})
    }.bind(this))

    this.don('destroy', function(){
      if (this.user) {
       this.dtr('store:posts:do:stopretrieve', this.user.uid)
      }
    })
  </script>
</app-user>
