<app-post>
  <div></div>

  <script>
    var Post = require('../app/post')
    var Mounter = require('../lib/mounter')

    var c, disp = require('../lib/dispatcher')

    this.on('unmount', function() { c.destroy() })

    this.on('mount', function() {
      c = disp.context()

      c.on('module:post-show:do:edit', function(post){
        if (this.post.equals(post)) {
          this.edit()
        }
      }.bind(this))
    })

    var m = new Mounter()

    this.post = new Post(opts.post)

    this.on('mount', function(){
      console.log('wrapper mounted')
    })

    this.on('update', function(){
      console.log('wrapper updated')
    })

    this.on('unmount', function(){
      console.log('wrapper unmounted')
    })

    this.on('mount', function(){
      if (this.post.stored) {
        this.show()
      } else {
        this.edit()
      }
    })

    show(data) {
      var n = this.root.firstElementChild
      m.display(n, 'app-post-show', {post: this.post})
    }

    edit(data) {
      var n = this.root.firstElementChild
      m.display(n, 'app-post-form', {post: this.post})
    }
  </script>
</app-post>
